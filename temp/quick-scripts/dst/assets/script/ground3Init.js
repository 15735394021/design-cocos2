
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/script/ground3Init.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, 'fa61eIvIg9OdrxRbu6vr74S', 'ground3Init');
// script/ground3Init.js

"use strict";

cc.Class({
  "extends": cc.Component,
  properties: {
    hit_audio: {
      //击打时的音效
      type: cc.AudioClip,
      "default": null
    },
    bg_audio: {
      //背景音乐
      type: cc.AudioClip,
      "default": null
    },
    ready_play: {
      //游戏加载中的进度条
      type: cc.Node,
      "default": null
    },
    ready_progress: {
      //游戏加载中的当前进度label
      type: cc.Label,
      "default": null
    },
    hero_pre: {
      type: cc.Prefab,
      "default": null
    },
    guai1_pre: {
      type: cc.Prefab,
      "default": null
    },
    topNode: {
      type: cc.Node,
      "default": null
    },
    mycamrea: {
      type: cc.Node,
      "default": null
    },
    hero: {
      type: cc.Node,
      "default": null
    }
  },
  onLoad: function onLoad() {
    var p = cc.director.getPhysicsManager();
    p.enabled = true; // p.gravity = cc.v2(0,-320);
    // p.debugDrawFlags = true;  //显示出来碰撞边框，为了方便演示

    cc.director.getCollisionManager().enabled = true; //检测碰撞
    // cc.director.getCollisionManager().enabledDebugDraw = true;//碰撞检测的边框显示

    this.ready_play.active = true;
    this.ready_progress.active = true;
    this.ready_play.getComponent(cc.ProgressBar).progress = 0;
    this.ready_progress.string = "地图正在初始化。。。";
    this.groundJs = this.node.getComponent("ground3");

    var _this = this;

    _this.groundJs.Init = function () {
      // _this.groundJs.mapCameraNode = hero_go.mycamrea;
      _this.hero.parent = _this.groundJs.getLayerNodeFun("map"); // cc.director.getPhysicsManager().gravity = cc.v2(0,-320);
      // console.log(_this.groundJs.getLayerNodeFun("map").Rect1);
    };

    this.groundJs.onLoadSprite = function (node, name) {
      //加载图块时调用  onLoadSprite(图块：Node，图层名：String)
      if (name == "map") {
        var tag0 = node.getComponent(cc.PolygonCollider);

        if (tag0 != null && tag0.tag == 0) {
          var body = node.addComponent(cc.RigidBody);
          body.type = cc.RigidBodyType.Static;
          var ps = tag0.points;
          var collider = node.addComponent(cc.PhysicsPolygonCollider);

          for (var i = 0; i < ps.length; i++) {
            if (i > 3) {
              collider.points.push({
                x: ps[i].x,
                y: ps[i].y
              });
            } else {
              collider.points[i].x = ps[i].x;
              collider.points[i].y = ps[i].y;
            }
          }

          collider.apply();
        }

        var tag1 = node.getComponent(cc.BoxCollider);

        if (tag1 != null && tag1.tag == 21) {
          var _body = node.addComponent(cc.RigidBody);

          _body.type = cc.RigidBodyType.Static;

          var _collider = node.addComponent(cc.PhysicsBoxCollider);

          _collider.offset = new cc.v2(0.5, 0);
          _collider.size.height = 10;

          _collider.apply();
        }
      }
    };

    this.groundJs.killSprite = function (node, name) {
      //每次图块从舞台上清除时调用    killSprite(图块：Node，图层名：String)
      if (name == "map") {
        var tag0 = node.getComponent(cc.PolygonCollider);

        if (tag0 != null && tag0.tag == 0) {
          var body = node.getComponent(cc.RigidBody);

          if (body == null) {
            return;
          }

          body.destroy();
          node.getComponent(cc.PhysicsPolygonCollider).destroy();
        }
      }
    };

    this.groundJs.Loading = function (Loaded, Total) {
      //Loading(已加载的贴图数：Number，总贴图数：Number)
      var progress = Loaded / Total;

      if (_this.ready_play != null) {
        _this.ready_progressNum = progress;
      }

      if (_this.ready_progress != null) {
        _this.ready_progress.string = "地图正在创建：" + progress * 100 + "%";
      }
    };
  },
  onDestroy: function onDestroy() {
    cc.audioEngine.stopAllEffects();
  },
  generate: function generate() {
    //加载英雄预制体进入地图
    var heroNode = cc.instantiate(this.hero_pre);
    var heroNodeJs = heroNode.getComponent("hero_go");
    heroNode.parent = this.groundJs.getLayerNodeFun("hero");
    heroNodeJs.mycamrea = this.mycamrea;
    heroNodeJs.groundJsNode = this.node;
    heroNodeJs.map = "ground3";
    this.initHero = true;
    this.topPosheight = this.topNode.getPosition().y - heroGo.node.getPosition().y; //界面顶部的top信息，等级，经验，头像等
  },
  start: function start() {
    cc.director.getPhysicsManager().gravity = cc.v2(0, -320);
  },
  huaiwu1Init: function huaiwu1Init() {
    var guai1 = this.groundJs.getLayerNodeFun("map").g401;
    this.initG1(guai1);
    var guai2 = this.groundJs.getLayerNodeFun("map").g402;
    this.initG1(guai2);
  },
  initG1: function initG1(guai) {
    //初始化地刺
    var guaiNode = cc.instantiate(this.guai1_pre);
    guaiNode.parent = this.groundJs.getLayerNodeFun("hero");
    guaiNode.setPosition(guai);
  },
  update: function update(dt) {
    if (this.ready_play != null) {
      var progress = this.ready_play.getComponent(cc.ProgressBar).progress;

      if (progress <= this.ready_progressNum) {
        progress = progress + 0.01;
        this.ready_play.getComponent(cc.ProgressBar).progress = progress;

        if (this.ready_play.getComponent(cc.ProgressBar).progress >= 1 && this.ready_play.getComponent(cc.ProgressBar).progress <= 1.02) {
          // this.ready_play.active = false;
          // this.ready_progress.active = false;
          this.ready_play.destroy();
          this.ready_play = null;
          cc.audioEngine.play(this.bg_audio, true, 0.3);
          this.generate();
          this.huaiwu1Init(); // this.node.getChildByName("hero").active = true;
        }
      }
    }

    if (this.initHero) {
      var viewX = heroGo.node.x;
      var viewY = heroGo.node.y;

      if (viewX <= 300) {
        viewX = 300;
      }

      if (viewX >= 4150) {
        viewX = 4150;
      }

      if (viewY >= -100) {
        viewY = -100;
      }

      if (viewY <= -4660) {
        viewY = -4660;
      }

      this.mycamrea.x = viewX;
      this.mycamrea.y = viewY;
      var pp = new cc.v2(viewX, viewY + this.topPosheight);
      this.topNode.setPosition(pp);
    }
  }
});

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0c1xcc2NyaXB0XFxncm91bmQzSW5pdC5qcyJdLCJuYW1lcyI6WyJjYyIsIkNsYXNzIiwiQ29tcG9uZW50IiwicHJvcGVydGllcyIsImhpdF9hdWRpbyIsInR5cGUiLCJBdWRpb0NsaXAiLCJiZ19hdWRpbyIsInJlYWR5X3BsYXkiLCJOb2RlIiwicmVhZHlfcHJvZ3Jlc3MiLCJMYWJlbCIsImhlcm9fcHJlIiwiUHJlZmFiIiwiZ3VhaTFfcHJlIiwidG9wTm9kZSIsIm15Y2FtcmVhIiwiaGVybyIsIm9uTG9hZCIsInAiLCJkaXJlY3RvciIsImdldFBoeXNpY3NNYW5hZ2VyIiwiZW5hYmxlZCIsImdldENvbGxpc2lvbk1hbmFnZXIiLCJhY3RpdmUiLCJnZXRDb21wb25lbnQiLCJQcm9ncmVzc0JhciIsInByb2dyZXNzIiwic3RyaW5nIiwiZ3JvdW5kSnMiLCJub2RlIiwiX3RoaXMiLCJJbml0IiwicGFyZW50IiwiZ2V0TGF5ZXJOb2RlRnVuIiwib25Mb2FkU3ByaXRlIiwibmFtZSIsInRhZzAiLCJQb2x5Z29uQ29sbGlkZXIiLCJ0YWciLCJib2R5IiwiYWRkQ29tcG9uZW50IiwiUmlnaWRCb2R5IiwiUmlnaWRCb2R5VHlwZSIsIlN0YXRpYyIsInBzIiwicG9pbnRzIiwiY29sbGlkZXIiLCJQaHlzaWNzUG9seWdvbkNvbGxpZGVyIiwiaSIsImxlbmd0aCIsInB1c2giLCJ4IiwieSIsImFwcGx5IiwidGFnMSIsIkJveENvbGxpZGVyIiwiUGh5c2ljc0JveENvbGxpZGVyIiwib2Zmc2V0IiwidjIiLCJzaXplIiwiaGVpZ2h0Iiwia2lsbFNwcml0ZSIsImRlc3Ryb3kiLCJMb2FkaW5nIiwiTG9hZGVkIiwiVG90YWwiLCJyZWFkeV9wcm9ncmVzc051bSIsIm9uRGVzdHJveSIsImF1ZGlvRW5naW5lIiwic3RvcEFsbEVmZmVjdHMiLCJnZW5lcmF0ZSIsImhlcm9Ob2RlIiwiaW5zdGFudGlhdGUiLCJoZXJvTm9kZUpzIiwiZ3JvdW5kSnNOb2RlIiwibWFwIiwiaW5pdEhlcm8iLCJ0b3BQb3NoZWlnaHQiLCJnZXRQb3NpdGlvbiIsImhlcm9HbyIsInN0YXJ0IiwiZ3Jhdml0eSIsImh1YWl3dTFJbml0IiwiZ3VhaTEiLCJnNDAxIiwiaW5pdEcxIiwiZ3VhaTIiLCJnNDAyIiwiZ3VhaSIsImd1YWlOb2RlIiwic2V0UG9zaXRpb24iLCJ1cGRhdGUiLCJkdCIsInBsYXkiLCJ2aWV3WCIsInZpZXdZIiwicHAiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQ0FBLEVBQUUsQ0FBQ0MsS0FBSCxDQUFTO0FBQ0wsYUFBU0QsRUFBRSxDQUFDRSxTQURQO0FBR0xDLEVBQUFBLFVBQVUsRUFBRTtBQUNSQyxJQUFBQSxTQUFTLEVBQUM7QUFBSztBQUNYQyxNQUFBQSxJQUFJLEVBQUNMLEVBQUUsQ0FBQ00sU0FERjtBQUVOLGlCQUFRO0FBRkYsS0FERjtBQUtSQyxJQUFBQSxRQUFRLEVBQUM7QUFBSztBQUNWRixNQUFBQSxJQUFJLEVBQUNMLEVBQUUsQ0FBQ00sU0FESDtBQUVMLGlCQUFRO0FBRkgsS0FMRDtBQVNSRSxJQUFBQSxVQUFVLEVBQUM7QUFBSTtBQUNYSCxNQUFBQSxJQUFJLEVBQUNMLEVBQUUsQ0FBQ1MsSUFERDtBQUVQLGlCQUFTO0FBRkYsS0FUSDtBQWFSQyxJQUFBQSxjQUFjLEVBQUM7QUFBSTtBQUNmTCxNQUFBQSxJQUFJLEVBQUNMLEVBQUUsQ0FBQ1csS0FERztBQUVYLGlCQUFRO0FBRkcsS0FiUDtBQWlCUkMsSUFBQUEsUUFBUSxFQUFDO0FBQ0xQLE1BQUFBLElBQUksRUFBQ0wsRUFBRSxDQUFDYSxNQURIO0FBRUwsaUJBQVE7QUFGSCxLQWpCRDtBQXFCUkMsSUFBQUEsU0FBUyxFQUFDO0FBQ05ULE1BQUFBLElBQUksRUFBQ0wsRUFBRSxDQUFDYSxNQURGO0FBRU4saUJBQVE7QUFGRixLQXJCRjtBQXlCUkUsSUFBQUEsT0FBTyxFQUFDO0FBQ0pWLE1BQUFBLElBQUksRUFBQ0wsRUFBRSxDQUFDUyxJQURKO0FBRUosaUJBQVE7QUFGSixLQXpCQTtB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QVI7QUFDSDs7QUFDRCxVQUFHQSxLQUFLLElBQUksSUFBWixFQUFpQjtBQUNiQSxRQUFBQSxLQUFLLEdBQUcsSUFBUjtBQUNIOztBQUNELFVBQUdDLEtBQUssSUFBSSxDQUFDLEdBQWIsRUFBaUI7QUFDYkEsUUFBQUEsS0FBSyxHQUFHLENBQUMsR0FBVDtBQUNIOztBQUNELFVBQUdBLEtBQUssSUFBSSxDQUFDLElBQWIsRUFBa0I7QUFDZEEsUUFBQUEsS0FBSyxHQUFHLENBQUMsSUFBVDtBQUNIOztBQUNELFdBQUtoRixRQUFMLENBQWNvQyxDQUFkLEdBQWtCMkMsS0FBbEI7QUFDQSxXQUFLL0UsUUFBTCxDQUFjcUMsQ0FBZCxHQUFrQjJDLEtBQWxCO0FBQ0EsVUFBSUMsRUFBRSxHQUFHLElBQUlqRyxFQUFFLENBQUMyRCxFQUFQLENBQVVvQyxLQUFWLEVBQWdCQyxLQUFLLEdBQUUsS0FBS2xCLFlBQTVCLENBQVQ7QUFDQSxXQUFLL0QsT0FBTCxDQUFhNEUsV0FBYixDQUF5Qk0sRUFBekI7QUFDSDtBQUNKO0FBdkxJLENBQVQiLCJzb3VyY2VSb290IjoiLyIsInNvdXJjZXNDb250ZW50IjpbIlxyXG5jYy5DbGFzcyh7XHJcbiAgICBleHRlbmRzOiBjYy5Db21wb25lbnQsXHJcblxyXG4gICAgcHJvcGVydGllczoge1xyXG4gICAgICAgIGhpdF9hdWRpbzp7ICAgIC8v5Ye75omT5pe255qE6Z+z5pWIXHJcbiAgICAgICAgICAgIHR5cGU6Y2MuQXVkaW9DbGlwLFxyXG4gICAgICAgICAgICBkZWZhdWx0Om51bGxcclxuICAgICAgICB9LFxyXG4gICAgICAgIGJnX2F1ZGlvOnsgICAgLy/og4zmma/pn7PkuZBcclxuICAgICAgICAgICAgdHlwZTpjYy5BdWRpb0NsaXAsXHJcbiAgICAgICAgICAgIGRlZmF1bHQ6bnVsbFxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgcmVhZHlfcGxheTp7ICAgLy/muLjmiI/liqDovb3kuK3nmoTov5vluqbmnaFcclxuICAgICAgICAgICAgdHlwZTpjYy5Ob2RlLFxyXG4gICAgICAgICAgICBkZWZhdWx0OiBudWxsXHJcbiAgICAgICAgfSxcclxuICAgICAgICByZWFkeV9wcm9ncmVzczp7ICAgLy/muLjmiI/liqDovb3kuK3nmoTlvZPliY3ov5vluqZsYWJlbFxyXG4gICAgICAgICAgICB0eXBlOmNjLkxhYmVsLFxyXG4gICAgICAgICAgICBkZWZhdWx0Om51bGxcclxuICAgICAgICB9LFxyXG4gICAgICAgIGhlcm9fcHJlOntcclxuICAgICAgICAgICAgdHlwZTpjYy5QcmVmYWIsXHJcbiAgICAgICAgICAgIGRlZmF1bHQ6bnVsbFxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZ3VhaTFfcHJlOntcclxuICAgICAgICAgICAgdHlwZTpjYy5QcmVmYWIsXHJcbiAgICAgICAgICAgIGRlZmF1bHQ6bnVsbFxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgdG9wTm9kZTp7XHJcbiAgICAgICAgICAgIHR5cGU6Y2MuTm9kZSxcclxuICAgICAgICAgICAgZGVmYXVsdDpudWxsXHJcbiAgICAgICAgfSxcclxuICAgICAgICBteWNhbXJlYTp7XHJcbiAgICAgICAgICAgIHR5cGU6Y2MuTm9kZSxcclxuICAgICAgICAgICAgZGVmYXVsdDpudWxsLFxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgaGVybzp7XHJcbiAgICAgICAgICAgIHR5cGU6Y2MuTm9kZSxcclxuICAgICAgICAgICAgZGVmYXVsdDpudWxsXHJcbiAgICAgICAgfVxyXG4gICAgfSxcclxuXHJcbiAgICBvbkxvYWQgKCkge1xyXG4gICAgICAgIGxldCBwID0gY2MuZGlyZWN0b3IuZ2V0UGh5c2ljc01hbmFnZXIoKTtcclxuICAgICAgICBwLmVuYWJsZWQgPSB0cnVlO1xyXG4gICAgICAgIC8vIHAuZ3Jhdml0eSA9IGNjLnYyKDAsLTMyMCk7XHJcbiAgICAgICAgLy8gcC5kZWJ1Z0RyYXdGbGFncyA9IHRydWU7ICAvL+aYvuekuuWHuuadpeeisOaSnui+ueahhu+8jOS4uuS6huaWueS+v+a8lOekulxyXG4gICAgICAgIGNjLmRpcmVjdG9yLmdldENvbGxpc2lvbk1hbmFnZXIoKS5lbmFibGVkID0gdHJ1ZTsgLy/mo4DmtYvnorDmkp5cclxuICAgICAgICAvLyBjYy5kaXJlY3Rvci5nZXRDb2xsaXNpb25NYW5hZ2VyKCkuZW5hYmxlZERlYnVnRHJhdyA9IHRydWU7Ly/norDmkp7mo4DmtYvnmoTovrnmoYbmmL7npLpcclxuXHJcbiAgICAgICAgdGhpcy5yZWFkeV9wbGF5LmFjdGl2ZSA9IHRydWU7XHJcbiAgICAgICAgdGhpcy5yZWFkeV9wcm9ncmVzcy5hY3RpdmUgPSB0cnVlO1xyXG4gICAgICAgIHRoaXMucmVhZHlfcGxheS5nZXRDb21wb25lbnQoY2MuUHJvZ3Jlc3NCYXIpLnByb2dyZXNzID0gMDtcclxuICAgICAgICB0aGlzLnJlYWR5X3Byb2dyZXNzLnN0cmluZyA9IFwi5Zyw5Zu+5q2j5Zyo5Yid5aeL5YyW44CC44CC44CCXCI7XHJcblxyXG4gICAgICAgIHRoaXMuZ3JvdW5kSnMgPSB0aGlzLm5vZGUuZ2V0Q29tcG9uZW50KFwiZ3JvdW5kM1wiKTtcclxuICAgICAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG4gICAgICAgIF90aGlzLmdyb3VuZEpzLkluaXQ9ZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgLy8gX3RoaXMuZ3JvdW5kSnMubWFwQ2FtZXJhTm9kZSA9IGhlcm9fZ28ubXljYW1yZWE7XHJcbiAgICAgICAgICAgIF90aGlzLmhlcm8ucGFyZW50ID0gX3RoaXMuZ3JvdW5kSnMuZ2V0TGF5ZXJOb2RlRnVuKFwibWFwXCIpO1xyXG4gICAgICAgICAgICAvLyBjYy5kaXJlY3Rvci5nZXRQaHlzaWNzTWFuYWdlcigpLmdyYXZpdHkgPSBjYy52MigwLC0zMjApO1xyXG4gICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhfdGhpcy5ncm91bmRKcy5nZXRMYXllck5vZGVGdW4oXCJtYXBcIikuUmVjdDEpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmdyb3VuZEpzLm9uTG9hZFNwcml0ZT1mdW5jdGlvbihub2RlLG5hbWUpeyAvL+WKoOi9veWbvuWdl+aXtuiwg+eUqCAgb25Mb2FkU3ByaXRlKOWbvuWdl++8mk5vZGXvvIzlm77lsYLlkI3vvJpTdHJpbmcpXHJcbiAgICAgICAgICAgIGlmKG5hbWUgPT0gXCJtYXBcIil7XHJcbiAgICAgICAgICAgICAgICBsZXQgdGFnMCA9IG5vZGUuZ2V0Q29tcG9uZW50KGNjLlBvbHlnb25Db2xsaWRlcik7XHJcbiAgICAgICAgICAgICAgICBpZih0YWcwICE9IG51bGwgJiYgdGFnMC50YWcgPT0gMCl7XHJcbiAgICAgICAgICAgICAgICAgICAgbGV0IGJvZHkgPSBub2RlLmFkZENvbXBvbmVudChjYy5SaWdpZEJvZHkpO1xyXG4gICAgICAgICAgICAgICAgICAgIGJvZHkudHlwZSA9IGNjLlJpZ2lkQm9keVR5cGUuU3RhdGljO1xyXG4gICAgICAgICAgICAgICAgICAgIGxldCBwcyA9IHRhZzAucG9pbnRzO1xyXG4gICAgICAgICAgICAgICAgICAgIGxldCBjb2xsaWRlciA9IG5vZGUuYWRkQ29tcG9uZW50KGNjLlBoeXNpY3NQb2x5Z29uQ29sbGlkZXIpO1xyXG4gICAgICAgICAgICAgICAgICAgIGZvcihsZXQgaT0wO2k8cHMubGVuZ3RoO2krKyl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKGkgPiAzKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbGxpZGVyLnBvaW50cy5wdXNoKHt4OnBzW2ldLngseTpwc1tpXS55fSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1lbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbGxpZGVyLnBvaW50c1tpXS54ID0gcHNbaV0ueDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbGxpZGVyLnBvaW50c1tpXS55ID0gcHNbaV0ueTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBjb2xsaWRlci5hcHBseSgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgbGV0IHRhZzEgPSBub2RlLmdldENvbXBvbmVudChjYy5Cb3hDb2xsaWRlcik7XHJcbiAgICAgICAgICAgICAgICBpZih0YWcxICE9IG51bGwgJiYgdGFnMS50YWcgPT0gMjEpe1xyXG4gICAgICAgICAgICAgICAgICAgIGxldCBib2R5ID0gbm9kZS5hZGRDb21wb25lbnQoY2MuUmlnaWRCb2R5KTtcclxuICAgICAgICAgICAgICAgICAgICBib2R5LnR5cGUgPSBjYy5SaWdpZEJvZHlUeXBlLlN0YXRpYztcclxuICAgICAgICAgICAgICAgICAgICBsZXQgY29sbGlkZXIgPSBub2RlLmFkZENvbXBvbmVudChjYy5QaHlzaWNzQm94Q29sbGlkZXIpO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbGxpZGVyLm9mZnNldCA9IG5ldyBjYy52MigwLjUsMClcclxuICAgICAgICAgICAgICAgICAgICBjb2xsaWRlci5zaXplLmhlaWdodCA9IDEwO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbGxpZGVyLmFwcGx5KCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5ncm91bmRKcy5raWxsU3ByaXRlPWZ1bmN0aW9uKG5vZGUsbmFtZSl7Ly/mr4/mrKHlm77lnZfku47oiJ7lj7DkuIrmuIXpmaTml7bosIPnlKggICAga2lsbFNwcml0ZSjlm77lnZfvvJpOb2Rl77yM5Zu+5bGC5ZCN77yaU3RyaW5nKVxyXG4gICAgICAgICAgICBpZihuYW1lID09IFwibWFwXCIpe1xyXG4gICAgICAgICAgICAgICAgbGV0IHRhZzAgPSBub2RlLmdldENvbXBvbmVudChjYy5Qb2x5Z29uQ29sbGlkZXIpO1xyXG4gICAgICAgICAgICAgICAgaWYodGFnMCAhPSBudWxsICYmIHRhZzAudGFnID09IDApe1xyXG4gICAgICAgICAgICAgICAgICAgIGxldCBib2R5ID0gbm9kZS5nZXRDb21wb25lbnQoY2MuUmlnaWRCb2R5KTtcclxuICAgICAgICAgICAgICAgICAgICBpZihib2R5ID09IG51bGwpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGJvZHkuZGVzdHJveSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIG5vZGUuZ2V0Q29tcG9uZW50KGNjLlBoeXNpY3NQb2x5Z29uQ29sbGlkZXIpLmRlc3Ryb3koKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmdyb3VuZEpzLkxvYWRpbmc9ZnVuY3Rpb24oTG9hZGVkLFRvdGFsKXsgICAvL0xvYWRpbmco5bey5Yqg6L2955qE6LS05Zu+5pWw77yaTnVtYmVy77yM5oC76LS05Zu+5pWw77yaTnVtYmVyKVxyXG4gICAgICAgICAgICBsZXQgcHJvZ3Jlc3MgPSBMb2FkZWQvVG90YWw7XHJcbiAgICAgICAgICAgIGlmKF90aGlzLnJlYWR5X3BsYXkgIT0gbnVsbCl7XHJcbiAgICAgICAgICAgICAgICBfdGhpcy5yZWFkeV9wcm9ncmVzc051bSA9IHByb2dyZXNzO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmKF90aGlzLnJlYWR5X3Byb2dyZXNzICE9IG51bGwpe1xyXG4gICAgICAgICAgICAgICAgX3RoaXMucmVhZHlfcHJvZ3Jlc3Muc3RyaW5nID1cIuWcsOWbvuato+WcqOWIm+W7uu+8mlwiKyBwcm9ncmVzcyoxMDArXCIlXCI7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9LFxyXG4gICAgb25EZXN0cm95KCl7XHJcbiAgICAgICAgY2MuYXVkaW9FbmdpbmUuc3RvcEFsbEVmZmVjdHMoKVxyXG4gICAgfSxcclxuXHJcbiAgICBnZW5lcmF0ZSgpey8v5Yqg6L296Iux6ZuE6aKE5Yi25L2T6L+b5YWl5Zyw5Zu+XHJcbiAgICAgICAgbGV0IGhlcm9Ob2RlID0gY2MuaW5zdGFudGlhdGUodGhpcy5oZXJvX3ByZSk7XHJcbiAgICAgICAgbGV0IGhlcm9Ob2RlSnMgPSBoZXJvTm9kZS5nZXRDb21wb25lbnQoXCJoZXJvX2dvXCIpO1xyXG4gICAgICAgIGhlcm9Ob2RlLnBhcmVudCA9IHRoaXMuZ3JvdW5kSnMuZ2V0TGF5ZXJOb2RlRnVuKFwiaGVyb1wiKTtcclxuICAgICAgICBoZXJvTm9kZUpzLm15Y2FtcmVhID0gdGhpcy5teWNhbXJlYTtcclxuICAgICAgICBoZXJvTm9kZUpzLmdyb3VuZEpzTm9kZSA9IHRoaXMubm9kZTtcclxuICAgICAgICBoZXJvTm9kZUpzLm1hcCA9IFwiZ3JvdW5kM1wiO1xyXG4gICAgICAgIHRoaXMuaW5pdEhlcm8gPSB0cnVlO1xyXG4gICAgICAgIHRoaXMudG9wUG9zaGVpZ2h0ID0gdGhpcy50b3BOb2RlLmdldFBvc2l0aW9uKCkueSAtIGhlcm9Hby5ub2RlLmdldFBvc2l0aW9uKCkueTsvL+eVjOmdoumhtumDqOeahHRvcOS/oeaBr++8jOetiee6p++8jOe7j+mqjO+8jOWktOWDj+etiVxyXG4gICAgfSxcclxuXHJcbiAgICBzdGFydCAoKSB7XHJcbiAgICAgICAgY2MuZGlyZWN0b3IuZ2V0UGh5c2ljc01hbmFnZXIoKS5ncmF2aXR5ID0gY2MudjIoMCwtMzIwKTtcclxuICAgIH0sXHJcbiAgICBodWFpd3UxSW5pdCgpe1xyXG4gICAgICAgIGxldCBndWFpMSA9IHRoaXMuZ3JvdW5kSnMuZ2V0TGF5ZXJOb2RlRnVuKFwibWFwXCIpLmc0MDE7XHJcbiAgICAgICAgdGhpcy5pbml0RzEoZ3VhaTEpO1xyXG4gICAgICAgIGxldCBndWFpMiA9IHRoaXMuZ3JvdW5kSnMuZ2V0TGF5ZXJOb2RlRnVuKFwibWFwXCIpLmc0MDI7XHJcbiAgICAgICAgdGhpcy5pbml0RzEoZ3VhaTIpO1xyXG4gICAgfSxcclxuICAgIGluaXRHMShndWFpKXsvL+WIneWni+WMluWcsOWIulxyXG4gICAgICAgIGxldCBndWFpTm9kZSA9IGNjLmluc3RhbnRpYXRlKHRoaXMuZ3VhaTFfcHJlKTtcclxuICAgICAgICBndWFpTm9kZS5wYXJlbnQgPSB0aGlzLmdyb3VuZEpzLmdldExheWVyTm9kZUZ1bihcImhlcm9cIik7XHJcbiAgICAgICAgZ3VhaU5vZGUuc2V0UG9zaXRpb24oZ3VhaSk7XHJcbiAgICB9LFxyXG5cclxuICAgIHVwZGF0ZSAoZHQpIHtcclxuICAgICAgICBpZih0aGlzLnJlYWR5X3BsYXkgIT0gbnVsbCl7XHJcbiAgICAgICAgICAgIGxldCBwcm9ncmVzcyA9IHRoaXMucmVhZHlfcGxheS5nZXRDb21wb25lbnQoY2MuUHJvZ3Jlc3NCYXIpLnByb2dyZXNzO1xyXG4gICAgICAgICAgICBpZihwcm9ncmVzcyA8PSB0aGlzLnJlYWR5X3Byb2dyZXNzTnVtKXtcclxuICAgICAgICAgICAgICAgIHByb2dyZXNzID0gcHJvZ3Jlc3MrMC4wMTtcclxuICAgICAgICAgICAgICAgIHRoaXMucmVhZHlfcGxheS5nZXRDb21wb25lbnQoY2MuUHJvZ3Jlc3NCYXIpLnByb2dyZXNzID0gcHJvZ3Jlc3M7XHJcbiAgICAgICAgICAgICAgICBpZih0aGlzLnJlYWR5X3BsYXkuZ2V0Q29tcG9uZW50KGNjLlByb2dyZXNzQmFyKS5wcm9ncmVzcyA+PSAxICYmIHRoaXMucmVhZHlfcGxheS5nZXRDb21wb25lbnQoY2MuUHJvZ3Jlc3NCYXIpLnByb2dyZXNzIDw9IDEuMDIpe1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIHRoaXMucmVhZHlfcGxheS5hY3RpdmUgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICAvLyB0aGlzLnJlYWR5X3Byb2dyZXNzLmFjdGl2ZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMucmVhZHlfcGxheS5kZXN0cm95KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZWFkeV9wbGF5ID0gbnVsbDtcclxuICAgICAgICAgICAgICAgICAgICBjYy5hdWRpb0VuZ2luZS5wbGF5KHRoaXMuYmdfYXVkaW8sdHJ1ZSwwLjMpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZ2VuZXJhdGUoKTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmh1YWl3dTFJbml0KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gdGhpcy5ub2RlLmdldENoaWxkQnlOYW1lKFwiaGVyb1wiKS5hY3RpdmUgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmKHRoaXMuaW5pdEhlcm8pe1xyXG4gICAgICAgICAgICBsZXQgdmlld1ggPSBoZXJvR28ubm9kZS54O1xyXG4gICAgICAgICAgICBsZXQgdmlld1kgPSBoZXJvR28ubm9kZS55O1xyXG4gICAgICAgICAgICBpZih2aWV3WCA8PSAzMDApe1xyXG4gICAgICAgICAgICAgICAgdmlld1ggPSAzMDA7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYodmlld1ggPj0gNDE1MCl7XHJcbiAgICAgICAgICAgICAgICB2aWV3WCA9IDQxNTA7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYodmlld1kgPj0gLTEwMCl7XHJcbiAgICAgICAgICAgICAgICB2aWV3WSA9IC0xMDA7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYodmlld1kgPD0gLTQ2NjApe1xyXG4gICAgICAgICAgICAgICAgdmlld1kgPSAtNDY2MDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLm15Y2FtcmVhLnggPSB2aWV3WDtcclxuICAgICAgICAgICAgdGhpcy5teWNhbXJlYS55ID0gdmlld1k7XHJcbiAgICAgICAgICAgIGxldCBwcCA9IG5ldyBjYy52Mih2aWV3WCx2aWV3WSArdGhpcy50b3BQb3NoZWlnaHQpO1xyXG4gICAgICAgICAgICB0aGlzLnRvcE5vZGUuc2V0UG9zaXRpb24ocHApO1xyXG4gICAgICAgIH1cclxuICAgIH0sXHJcbn0pO1xyXG4iXX0=