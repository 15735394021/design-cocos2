
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/script/heroModel.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, '835d1dI699LlrgSrNQRk/Eg', 'heroModel');
// script/heroModel.js

"use strict";

cc.Class({
  "extends": cc.Component,
  properties: {
    heroGrade: {
      //等级
      type: cc.Node,
      "default": null
    },
    heroExperience: {
      //经验值
      type: cc.Node,
      "default": null
    },
    heroLife: {
      //生命值
      type: cc.Node,
      "default": null
    },
    heroGold: {
      //金币
      type: cc.Node,
      "default": null
    },
    die_audio: {
      type: cc.AudioClip,
      "default": null
    },
    hurt_audio: {
      type: cc.AudioClip,
      "default": null
    }
  },
  onLoad: function onLoad() {
    window.heroModel = this;
    this.baseUrl = cc.sys.localStorage.getItem("baseUrl");
    this.userId = cc.sys.localStorage.getItem("userId");

    if (this.baseUrl == null || this.userId == null) {
      cc.director.loadScene("welcome");
    }

    this.queryHeroDetail();
  },
  queryHeroDetail: function queryHeroDetail() {
    var xhr = new XMLHttpRequest();

    xhr.onreadystatechange = function () {
      if (xhr.readyState == 4 && xhr.status >= 200 && xhr.status < 400) {
        var response = JSON.parse(xhr.responseText);

        if (response.status == 0) {
          var data = response.data[0];
          this.heroGold.getComponent(cc.Label).string = data.userGold;
        }
      }
    }.bind(this);

    xhr.open("GET", this.baseUrl + "archives/queryArchives?userId=" + this.userId, true);
    xhr.send();
  },
  addGrade: function addGrade() {
    //增加等级
    var grade = parseInt(this.heroGrade.getComponent(cc.Label).string);
    this.heroGrade.getComponent(cc.Label).string = grade + 1;
  },
  addExperience: function addExperience(num) {
    //增加经验值
    var totol = parseInt(this.heroExperience.getChildByName("bar").width);
    totol += parseInt(num);

    if (totol < this.heroExperience.getComponent(cc.ProgressBar).totalLength) {
      this.heroExperience.getChildByName("bar").width = totol;
    } else {
      this.addGrade();
      this.heroExperience.getChildByName("bar").width = totol / 300;
    }
  },
  addLife: function addLife(num) {
    var life = parseInt(this.heroLife.getChildByName("bar").width);
    life += parseInt(num);

    if (life < this.heroLife.getComponent(cc.ProgressBar).totalLength) {
      this.heroLife.getChildByName("bar").width = life;
    } else {
      this.heroLife.getChildByName("bar").width = 300;
    }

    this.isDie = false; // let life = this.heroLife.getChildByName("bar").scaleX;
  },
  hit: function hit(num) {
    var life = parseInt(this.heroLife.getChildByName("bar").width);
    life -= parseInt(num);

    if (life > 0) {
      cc.audioEngine.play(this.hurt_audio, false, 0.4);
      this.heroLife.getChildByName("bar").width = life;
    } else {
      this.heroLife.getChildByName("bar").width = 0;

      if (this.isDie == true) {
        return;
      }

      this.isDie = true;
      this.die();
    }
  },
  die: function die() {
    cc.audioEngine.play(this.die_audio, false, 0.4);
    var timer1 = window.setTimeout(function () {
      alert("英雄死亡，点击确定重新加载当前地图");
      cc.director.loadScene(cc.director.getScene().getName());
    }, 1000); // heroGo.destroy();
  },
  addGold: function addGold(num) {
    //增加金币
    var gold = parseInt(this.heroGold.getComponent(cc.Label).string);
    this.heroGold.getComponent(cc.Label).string = gold + num;
  },
  useGold: function useGold(num) {
    //使用金币，减少
    var gold = parseInt(this.heroGold.getComponent(cc.Label).string);
    this.heroGold.getComponent(cc.Label).string = gold - num;
  },
  update: function update(dt) {}
});

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0c1xcc2NyaXB0XFxoZXJvTW9kZWwuanMiXSwibmFtZXMiOlsiY2MiLCJDbGFzcyIsIkNvbXBvbmVudCIsInByb3BlcnRpZXMiLCJoZXJvR3JhZGUiLCJ0eXBlIiwiTm9kZSIsImhlcm9FeHBlcmllbmNlIiwiaGVyb0xpZmUiLCJoZXJvR29sZCIsImRpZV9hdWRpbyIsIkF1ZGlvQ2xpcCIsImh1cnRfYXVkaW8iLCJvbkxvYWQiLCJ3aW5kb3ciLCJoZXJvTW9kZWwiLCJiYXNlVXJsIiwic3lzIiwibG9jYWxTdG9yYWdlIiwiZ2V0SXRlbSIsInVzZXJJZCIsImRpcmVjdG9yIiwibG9hZFNjZW5lIiwicXVlcnlIZXJvRGV0YWlsIiwieGhyIiwiWE1MSHR0cFJlcXVlc3QiLCJvbnJlYWR5c3RhdGVjaGFuZ2UiLCJyZWFkeVN0YXRlIiwic3RhdHVzIiwicmVzcG9uc2UiLCJKU09OIiwicGFyc2UiLCJyZXNwb25zZVRleHQiLCJkYXRhIiwiZ2V0Q29tcG9uZW50IiwiTGFiZWwiLCJzdHJpbmciLCJ1c2VyR29sZCIsImJpbmQiLCJvcGVuIiwic2VuZCIsImFkZEdyYWRlIiwiZ3JhZGUiLCJwYXJzZUludCIsImFkZEV4cGVyaWVuY2UiLCJudW0iLCJ0b3RvbCIsImdldENoaWxkQnlOYW1lIiwid2lkdGgiLCJQcm9ncmVzc0JhciIsInRvdGFsTGVuZ3RoIiwiYWRkTGlmZSIsImxpZmUiLCJpc0RpZSIsImhpdCIsImF1ZGlvRW5naW5lIiwicGxheSIsImRpZSIsInRpbWVyMSIsInNldFRpbWVvdXQiLCJhbGVydCIsImdldFNjZW5lIiwiZ2V0TmFtZSIsImFkZEdvbGQiLCJnb2xkIiwidXNlR29sZCIsInVwZGF0ZSIsImR0Il0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7OztBQUFBQSxFQUFFLENBQUNDLEtBQUgsQ0FBUztBQUNMLGFBQVNELEVBQUUsQ0FBQ0UsU0FEUDtBQUdMQyxFQUFBQSxVQUFVLEVBQUU7QUFDUkMsSUFBQUEsU0FBUyxFQUFDO0FBQUM7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LE9BMUdLLG1CQTBHR2xCLEdBMUdILEVBMEdPO0FBQUM7QUFDVCxRQUFJbUIsSUFBSSxHQUFHckIsUUFBUSxDQUFDLEtBQUtsQyxRQUFMLENBQWN5QixZQUFkLENBQTJCbEMsRUFBRSxDQUFDbUMsS0FBOUIsRUFBcUNDLE1BQXRDLENBQW5CO0FBQ0EsU0FBSzNCLFFBQUwsQ0FBY3lCLFlBQWQsQ0FBMkJsQyxFQUFFLENBQUNtQyxLQUE5QixFQUFxQ0MsTUFBckMsR0FBOEM0QixJQUFJLEdBQUNuQixHQUFuRDtBQUNILEdBN0dJO0FBK0dMb0IsRUFBQUEsT0EvR0ssbUJBK0dHcEIsR0EvR0gsRUErR087QUFBQztBQUNULFFBQUltQixJQUFJLEdBQUdyQixRQUFRLENBQUMsS0FBS2xDLFFBQUwsQ0FBY3lCLFlBQWQsQ0FBMkJsQyxFQUFFLENBQUNtQyxLQUE5QixFQUFxQ0MsTUFBdEMsQ0FBbkI7QUFDQSxTQUFLM0IsUUFBTCxDQUFjeUIsWUFBZCxDQUEyQmxDLEVBQUUsQ0FBQ21DLEtBQTlCLEVBQXFDQyxNQUFyQyxHQUE4QzRCLElBQUksR0FBQ25CLEdBQW5EO0FBQ0gsR0FsSEk7QUFvSExxQixFQUFBQSxNQXBISyxrQkFvSEdDLEVBcEhILEVBb0hPLENBRVg7QUF0SEksQ0FBVCIsInNvdXJjZVJvb3QiOiIvIiwic291cmNlc0NvbnRlbnQiOlsiY2MuQ2xhc3Moe1xyXG4gICAgZXh0ZW5kczogY2MuQ29tcG9uZW50LFxyXG5cclxuICAgIHByb3BlcnRpZXM6IHtcclxuICAgICAgICBoZXJvR3JhZGU6ey8v562J57qnXHJcbiAgICAgICAgICAgIHR5cGU6Y2MuTm9kZSxcclxuICAgICAgICAgICAgZGVmYXVsdDpudWxsXHJcbiAgICAgICAgfSxcclxuICAgICAgICBoZXJvRXhwZXJpZW5jZTp7Ly/nu4/pqozlgLxcclxuICAgICAgICAgICAgdHlwZTpjYy5Ob2RlLFxyXG4gICAgICAgICAgICBkZWZhdWx0Om51bGxcclxuICAgICAgICB9LFxyXG4gICAgICAgIGhlcm9MaWZlOnsvL+eUn+WRveWAvFxyXG4gICAgICAgICAgICB0eXBlOmNjLk5vZGUsXHJcbiAgICAgICAgICAgIGRlZmF1bHQ6bnVsbFxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgaGVyb0dvbGQ6ey8v6YeR5biBXHJcbiAgICAgICAgICAgIHR5cGU6Y2MuTm9kZSxcclxuICAgICAgICAgICAgZGVmYXVsdDpudWxsXHJcbiAgICAgICAgfSxcclxuICAgICAgICBkaWVfYXVkaW86e1xyXG4gICAgICAgICAgICB0eXBlOmNjLkF1ZGlvQ2xpcCxcclxuICAgICAgICAgICAgZGVmYXVsdDpudWxsXHJcbiAgICAgICAgfSxcclxuICAgICAgICBodXJ0X2F1ZGlvOntcclxuICAgICAgICAgICAgdHlwZTpjYy5BdWRpb0NsaXAsXHJcbiAgICAgICAgICAgIGRlZmF1bHQ6bnVsbFxyXG4gICAgICAgIH0sXHJcbiAgICB9LFxyXG5cclxuICAgIG9uTG9hZCAoKSB7XHJcbiAgICAgICAgd2luZG93Lmhlcm9Nb2RlbCA9IHRoaXM7XHJcbiAgICAgICAgdGhpcy5iYXNlVXJsID0gY2Muc3lzLmxvY2FsU3RvcmFnZS5nZXRJdGVtKFwiYmFzZVVybFwiKTtcclxuICAgICAgICB0aGlzLnVzZXJJZCA9IGNjLnN5cy5sb2NhbFN0b3JhZ2UuZ2V0SXRlbShcInVzZXJJZFwiKTtcclxuICAgICAgICBpZih0aGlzLmJhc2VVcmwgPT0gbnVsbCB8fCB0aGlzLnVzZXJJZCA9PSBudWxsKXtcclxuICAgICAgICAgICAgY2MuZGlyZWN0b3IubG9hZFNjZW5lKFwid2VsY29tZVwiKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5xdWVyeUhlcm9EZXRhaWwoKTtcclxuICAgIH0sXHJcblxyXG4gICAgcXVlcnlIZXJvRGV0YWlsKCl7XHJcbiAgICAgICAgbGV0IHhociA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpO1xyXG4gICAgICAgIHhoci5vbnJlYWR5c3RhdGVjaGFuZ2UgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIGlmICh4aHIucmVhZHlTdGF0ZSA9PSA0ICYmICh4aHIuc3RhdHVzID49IDIwMCAmJiB4aHIuc3RhdHVzIDwgNDAwKSkge1xyXG4gICAgICAgICAgICAgICAgdmFyIHJlc3BvbnNlID0gSlNPTi5wYXJzZSh4aHIucmVzcG9uc2VUZXh0KTtcclxuICAgICAgICAgICAgICAgIGlmKHJlc3BvbnNlLnN0YXR1cyA9PSAwKXtcclxuICAgICAgICAgICAgICAgICAgICBsZXQgZGF0YSA9IHJlc3BvbnNlLmRhdGFbMF07XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5oZXJvR29sZC5nZXRDb21wb25lbnQoY2MuTGFiZWwpLnN0cmluZyA9ZGF0YS51c2VyR29sZDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0uYmluZCh0aGlzKTtcclxuICAgICAgICB4aHIub3BlbihcIkdFVFwiLCB0aGlzLmJhc2VVcmwrXCJhcmNoaXZlcy9xdWVyeUFyY2hpdmVzP3VzZXJJZD1cIit0aGlzLnVzZXJJZCwgdHJ1ZSk7XHJcbiAgICAgICAgeGhyLnNlbmQoKTtcclxuICAgIH0sXHJcblxyXG4gICAgYWRkR3JhZGUoKXsvL+WinuWKoOetiee6p1xyXG4gICAgICAgIGxldCBncmFkZSA9IHBhcnNlSW50KHRoaXMuaGVyb0dyYWRlLmdldENvbXBvbmVudChjYy5MYWJlbCkuc3RyaW5nKTtcclxuICAgICAgICB0aGlzLmhlcm9HcmFkZS5nZXRDb21wb25lbnQoY2MuTGFiZWwpLnN0cmluZyA9IGdyYWRlKzE7XHJcbiAgICB9LFxyXG5cclxuICAgIGFkZEV4cGVyaWVuY2UobnVtKXsvL+WinuWKoOe7j+mqjOWAvFxyXG4gICAgICAgIGxldCB0b3RvbCA9IHBhcnNlSW50KHRoaXMuaGVyb0V4cGVyaWVuY2UuZ2V0Q2hpbGRCeU5hbWUoXCJiYXJcIikud2lkdGgpO1xyXG4gICAgICAgIHRvdG9sICs9IHBhcnNlSW50KG51bSk7XHJcbiAgICAgICAgaWYodG90b2wgPCB0aGlzLmhlcm9FeHBlcmllbmNlLmdldENvbXBvbmVudChjYy5Qcm9ncmVzc0JhcikudG90YWxMZW5ndGgpe1xyXG4gICAgICAgICAgICB0aGlzLmhlcm9FeHBlcmllbmNlLmdldENoaWxkQnlOYW1lKFwiYmFyXCIpLndpZHRoID0gdG90b2w7XHJcbiAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgIHRoaXMuYWRkR3JhZGUoKTtcclxuICAgICAgICAgICAgdGhpcy5oZXJvRXhwZXJpZW5jZS5nZXRDaGlsZEJ5TmFtZShcImJhclwiKS53aWR0aCA9IHRvdG9sLzMwMDtcclxuICAgICAgICB9XHJcbiAgICB9LFxyXG5cclxuICAgIGFkZExpZmUobnVtKXtcclxuICAgICAgICBsZXQgbGlmZSA9IHBhcnNlSW50KHRoaXMuaGVyb0xpZmUuZ2V0Q2hpbGRCeU5hbWUoXCJiYXJcIikud2lkdGgpO1xyXG4gICAgICAgIGxpZmUgKz0gcGFyc2VJbnQobnVtKTtcclxuICAgICAgICBpZihsaWZlIDwgdGhpcy5oZXJvTGlmZS5nZXRDb21wb25lbnQoY2MuUHJvZ3Jlc3NCYXIpLnRvdGFsTGVuZ3RoKXtcclxuICAgICAgICAgICAgdGhpcy5oZXJvTGlmZS5nZXRDaGlsZEJ5TmFtZShcImJhclwiKS53aWR0aCA9IGxpZmU7XHJcbiAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgIHRoaXMuaGVyb0xpZmUuZ2V0Q2hpbGRCeU5hbWUoXCJiYXJcIikud2lkdGggPSAzMDA7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuaXNEaWUgPSBmYWxzZTtcclxuICAgICAgICAvLyBsZXQgbGlmZSA9IHRoaXMuaGVyb0xpZmUuZ2V0Q2hpbGRCeU5hbWUoXCJiYXJcIikuc2NhbGVYO1xyXG4gICAgfSxcclxuICAgIGhpdChudW0pe1xyXG4gICAgICAgIGxldCBsaWZlID0gcGFyc2VJbnQodGhpcy5oZXJvTGlmZS5nZXRDaGlsZEJ5TmFtZShcImJhclwiKS53aWR0aCk7XHJcbiAgICAgICAgbGlmZSAtPSBwYXJzZUludChudW0pO1xyXG4gICAgICAgIGlmKGxpZmUgPiAwKXtcclxuICAgICAgICAgICAgY2MuYXVkaW9FbmdpbmUucGxheSh0aGlzLmh1cnRfYXVkaW8sZmFsc2UsMC40KTtcclxuICAgICAgICAgICAgdGhpcy5oZXJvTGlmZS5nZXRDaGlsZEJ5TmFtZShcImJhclwiKS53aWR0aCA9IGxpZmU7XHJcbiAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgIHRoaXMuaGVyb0xpZmUuZ2V0Q2hpbGRCeU5hbWUoXCJiYXJcIikud2lkdGggPSAwO1xyXG4gICAgICAgICAgICBpZih0aGlzLmlzRGllID09IHRydWUpe1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMuaXNEaWUgPSB0cnVlO1xyXG4gICAgICAgICAgICB0aGlzLmRpZSgpO1xyXG4gICAgICAgIH1cclxuICAgIH0sXHJcbiAgICBkaWUoKXtcclxuICAgICAgICBjYy5hdWRpb0VuZ2luZS5wbGF5KHRoaXMuZGllX2F1ZGlvLGZhbHNlLDAuNCk7XHJcbiAgICAgICAgdmFyIHRpbWVyMT13aW5kb3cuc2V0VGltZW91dChmdW5jdGlvbiAoKXtcclxuICAgICAgICAgICAgYWxlcnQoXCLoi7Hpm4TmrbvkuqHvvIzngrnlh7vnoa7lrprph43mlrDliqDovb3lvZPliY3lnLDlm75cIik7XHJcbiAgICAgICAgICAgIGNjLmRpcmVjdG9yLmxvYWRTY2VuZShjYy5kaXJlY3Rvci5nZXRTY2VuZSgpLmdldE5hbWUoKSk7XHJcbiAgICAgICAgfSwxMDAwKTtcclxuICAgICAgICAvLyBoZXJvR28uZGVzdHJveSgpO1xyXG4gICAgfSxcclxuXHJcbiAgICBhZGRHb2xkKG51bSl7Ly/lop7liqDph5HluIFcclxuICAgICAgICBsZXQgZ29sZCA9IHBhcnNlSW50KHRoaXMuaGVyb0dvbGQuZ2V0Q29tcG9uZW50KGNjLkxhYmVsKS5zdHJpbmcpO1xyXG4gICAgICAgIHRoaXMuaGVyb0dvbGQuZ2V0Q29tcG9uZW50KGNjLkxhYmVsKS5zdHJpbmcgPSBnb2xkK251bTtcclxuICAgIH0sXHJcblxyXG4gICAgdXNlR29sZChudW0pey8v5L2/55So6YeR5biB77yM5YeP5bCRXHJcbiAgICAgICAgbGV0IGdvbGQgPSBwYXJzZUludCh0aGlzLmhlcm9Hb2xkLmdldENvbXBvbmVudChjYy5MYWJlbCkuc3RyaW5nKTtcclxuICAgICAgICB0aGlzLmhlcm9Hb2xkLmdldENvbXBvbmVudChjYy5MYWJlbCkuc3RyaW5nID0gZ29sZC1udW07XHJcbiAgICB9LFxyXG5cclxuICAgIHVwZGF0ZSAoZHQpIHtcclxuXHJcbiAgICB9LFxyXG59KTtcclxuIl19