{"version":3,"sources":["assets\\script\\ground3Init.js"],"names":["cc","Class","Component","properties","hit_audio","type","AudioClip","bg_audio","ready_play","Node","ready_progress","Label","hero_pre","Prefab","topNode","mycamrea","hero","onLoad","p","director","getPhysicsManager","enabled","getCollisionManager","active","getComponent","ProgressBar","progress","string","groundJs","node","_this","Init","parent","getLayerNodeFun","onLoadSprite","name","tag0","PolygonCollider","tag","body","addComponent","RigidBody","RigidBodyType","Static","ps","points","collider","PhysicsPolygonCollider","i","length","push","x","y","apply","tag1","BoxCollider","PhysicsBoxCollider","offset","v2","size","height","killSprite","destroy","Loading","Loaded","Total","ready_progressNum","onDestroy","audioEngine","stopAllEffects","generate","heroNode","instantiate","heroNodeJs","groundJsNode","map","initHero","topPosheight","getPosition","heroGo","start","gravity","update","dt","play","viewX","viewY","pp","setPosition"],"mappings":"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","sourceRoot":"/","sourcesContent":["\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        hit_audio:{    //击打时的音效\r\n            type:cc.AudioClip,\r\n            default:null\r\n        },\r\n        bg_audio:{    //背景音乐\r\n            type:cc.AudioClip,\r\n            default:null\r\n        },\r\n        ready_play:{   //游戏加载中的进度条\r\n            type:cc.Node,\r\n            default: null\r\n        },\r\n        ready_progress:{   //游戏加载中的当前进度label\r\n            type:cc.Label,\r\n            default:null\r\n        },\r\n        hero_pre:{\r\n            type:cc.Prefab,\r\n            default:null\r\n        },\r\n        topNode:{\r\n            type:cc.Node,\r\n            default:null\r\n        },\r\n        mycamrea:{\r\n            type:cc.Node,\r\n            default:null,\r\n        },\r\n        hero:{\r\n            type:cc.Node,\r\n            default:null\r\n        }\r\n    },\r\n\r\n    onLoad () {\r\n        let p = cc.director.getPhysicsManager();\r\n        p.enabled = true;\r\n        // p.gravity = cc.v2(0,-320);\r\n        // p.debugDrawFlags = true;  //显示出来碰撞边框，为了方便演示\r\n        cc.director.getCollisionManager().enabled = true; //检测碰撞\r\n        // cc.director.getCollisionManager().enabledDebugDraw = true;//碰撞检测的边框显示\r\n\r\n        this.ready_play.active = true;\r\n        this.ready_progress.active = true;\r\n        this.ready_play.getComponent(cc.ProgressBar).progress = 0;\r\n        this.ready_progress.string = \"地图正在初始化。。。\";\r\n\r\n        this.groundJs = this.node.getComponent(\"ground3\");\r\n        let _this = this;\r\n        _this.groundJs.Init=function(){\r\n            // _this.groundJs.mapCameraNode = hero_go.mycamrea;\r\n            _this.hero.parent = _this.groundJs.getLayerNodeFun(\"map\");\r\n            // cc.director.getPhysicsManager().gravity = cc.v2(0,-320);\r\n            // console.log(_this.groundJs.getLayerNodeFun(\"map\").Rect1);\r\n        }\r\n        this.groundJs.onLoadSprite=function(node,name){ //加载图块时调用  onLoadSprite(图块：Node，图层名：String)\r\n            if(name == \"map\"){\r\n                let tag0 = node.getComponent(cc.PolygonCollider);\r\n                if(tag0 != null && tag0.tag == 0){\r\n                    let body = node.addComponent(cc.RigidBody);\r\n                    body.type = cc.RigidBodyType.Static;\r\n                    let ps = tag0.points;\r\n                    let collider = node.addComponent(cc.PhysicsPolygonCollider);\r\n                    for(let i=0;i<ps.length;i++){\r\n                        if(i > 3){\r\n                            collider.points.push({x:ps[i].x,y:ps[i].y});\r\n                        }else {\r\n                            collider.points[i].x = ps[i].x;\r\n                            collider.points[i].y = ps[i].y;\r\n                        }\r\n                    }\r\n                    collider.apply();\r\n                }\r\n                let tag1 = node.getComponent(cc.BoxCollider);\r\n                if(tag1 != null && tag1.tag == 21){\r\n                    let body = node.addComponent(cc.RigidBody);\r\n                    body.type = cc.RigidBodyType.Static;\r\n                    let collider = node.addComponent(cc.PhysicsBoxCollider);\r\n                    collider.offset = new cc.v2(0.5,0)\r\n                    collider.size.height = 10;\r\n                    collider.apply();\r\n                }\r\n            }\r\n        }\r\n        this.groundJs.killSprite=function(node,name){//每次图块从舞台上清除时调用    killSprite(图块：Node，图层名：String)\r\n            if(name == \"map\"){\r\n                let tag0 = node.getComponent(cc.PolygonCollider);\r\n                if(tag0 != null && tag0.tag == 0){\r\n                    let body = node.getComponent(cc.RigidBody);\r\n                    if(body == null){\r\n                        return;\r\n                    }\r\n                    body.destroy();\r\n                    node.getComponent(cc.PhysicsPolygonCollider).destroy();\r\n                }\r\n            }\r\n        }\r\n        this.groundJs.Loading=function(Loaded,Total){   //Loading(已加载的贴图数：Number，总贴图数：Number)\r\n            let progress = Loaded/Total;\r\n            if(_this.ready_play != null){\r\n                _this.ready_progressNum = progress;\r\n            }\r\n            if(_this.ready_progress != null){\r\n                _this.ready_progress.string =\"地图正在创建：\"+ progress*100+\"%\";\r\n            }\r\n        }\r\n    },\r\n    onDestroy(){\r\n        cc.audioEngine.stopAllEffects()\r\n    },\r\n\r\n    generate(){//加载英雄预制体进入地图\r\n        let heroNode = cc.instantiate(this.hero_pre);\r\n        let heroNodeJs = heroNode.getComponent(\"hero_go\");\r\n        heroNode.parent = this.groundJs.getLayerNodeFun(\"hero\");\r\n        heroNodeJs.mycamrea = this.mycamrea;\r\n        heroNodeJs.groundJsNode = this.node;\r\n        heroNodeJs.map = \"ground3\";\r\n        this.initHero = true;\r\n        this.topPosheight = this.topNode.getPosition().y - heroGo.node.getPosition().y;//界面顶部的top信息，等级，经验，头像等\r\n    },\r\n\r\n    start () {\r\n        cc.director.getPhysicsManager().gravity = cc.v2(0,-320);\r\n    },\r\n\r\n    update (dt) {\r\n        if(this.ready_play != null){\r\n            let progress = this.ready_play.getComponent(cc.ProgressBar).progress;\r\n            if(progress <= this.ready_progressNum){\r\n                progress = progress+0.01;\r\n                this.ready_play.getComponent(cc.ProgressBar).progress = progress;\r\n                if(this.ready_play.getComponent(cc.ProgressBar).progress >= 1 && this.ready_play.getComponent(cc.ProgressBar).progress <= 1.02){\r\n                    // this.ready_play.active = false;\r\n                    // this.ready_progress.active = false;\r\n                    this.ready_play.destroy();\r\n                    this.ready_play = null;\r\n                    cc.audioEngine.play(this.bg_audio,true,0.3);\r\n                    this.generate();\r\n                    // this.node.getChildByName(\"hero\").active = true;\r\n                }\r\n            }\r\n        }\r\n        if(this.initHero){\r\n            let viewX = heroGo.node.x;\r\n            let viewY = heroGo.node.y;\r\n            if(viewX <= 300){\r\n                viewX = 300;\r\n            }\r\n            if(viewX >= 4150){\r\n                viewX = 4150;\r\n            }\r\n            if(viewY >= -100){\r\n                viewY = -100;\r\n            }\r\n            if(viewY <= -4660){\r\n                viewY = -4660;\r\n            }\r\n            this.mycamrea.x = viewX;\r\n            this.mycamrea.y = viewY;\r\n            let pp = new cc.v2(viewX,viewY +this.topPosheight);\r\n            this.topNode.setPosition(pp);\r\n        }\r\n    },\r\n});\r\n"]}