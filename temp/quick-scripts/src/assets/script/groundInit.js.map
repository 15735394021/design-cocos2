{"version":3,"sources":["assets\\script\\groundInit.js"],"names":["cc","Class","Component","properties","hit_audio","type","AudioClip","bg_audio","ready_play","Node","ready_progress","Label","flameParticle","ParticleSystem","onLoad","p","director","getPhysicsManager","enabled","gravity","v2","getCollisionManager","groundJs","node","getComponent","_this","Init","mapCameraNode","hero_go","mycamrea","parent","getLayerNodeFun","onLoadSpriteParent","n","LayerName","bo","onLoadYMovieClip","ymc","layerName","name","on","event","audioEngine","play","onLoadSprite","tag0","PolygonCollider","tag","body","addComponent","RigidBody","RigidBodyType","Static","ps","points","collider","PhysicsPolygonCollider","i","length","push","x","y","apply","killSprite","destroy","Loading","Loaded","Total","progress","ready_progressNum","string","start","closeDoor","point1","point2","update","dt","ProgressBar","active"],"mappings":"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","sourceRoot":"/","sourcesContent":["cc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        hit_audio:{    //击打时的音效\r\n            type:cc.AudioClip,\r\n            default:null\r\n        },\r\n        bg_audio:{    //背景音乐\r\n            type:cc.AudioClip,\r\n            default:null\r\n        },\r\n        ready_play:{   //游戏加载中的进度条\r\n            type:cc.Node,\r\n            default: null\r\n        },\r\n        ready_progress:{   //游戏加载中的当前进度label\r\n            type:cc.Label,\r\n            default:null\r\n        },\r\n        flameParticle:{   //火焰粒子，用在村庄门口的开门关门效果\r\n            type:cc.ParticleSystem,\r\n            default:null\r\n        }\r\n    },\r\n\r\n    onLoad () {\r\n\r\n        let p = cc.director.getPhysicsManager();\r\n        p.enabled = true;\r\n        p.gravity = cc.v2(0,0);\r\n        // p.debugDrawFlags = true;  //显示出来碰撞边框，为了方便演示\r\n        cc.director.getCollisionManager().enabled = true; //检测碰撞\r\n        // cc.director.getCollisionManager().enabledDebugDraw = true;//碰撞检测的边框显示\r\n\r\n        this.groundJs = this.node.getComponent(\"ground2\");\r\n        let _this = this;\r\n        _this.groundJs.Init=function(){\r\n            _this.groundJs.mapCameraNode = hero_go.mycamrea;\r\n            hero_go.node.parent = _this.groundJs.getLayerNodeFun(\"map\");\r\n            // console.log(_this.groundJs.getLayerNodeFun(\"map\").Rect1);\r\n        }\r\n        _this.groundJs.onLoadSpriteParent=function(n,LayerName,bo){//onLoadSpriteParent(父节点：Node，图层名：String，是否第一次加载：bool)\r\n\r\n        }\r\n        _this.groundJs.onLoadYMovieClip=function(ymc,layerName,bo){//加载动画\r\n            if(ymc.name == \"hk1\"){\r\n                ymc.on(\"sound\",function(event){\r\n                    cc.audioEngine.play(_this.hit_audio,false,0.3);\r\n                })\r\n            }\r\n        }\r\n        this.groundJs.onLoadSprite=function(node,name){ //加载图块时调用  onLoadSprite(图块：Node，图层名：String)\r\n            if(name == \"map\"){\r\n                let tag0 = node.getComponent(cc.PolygonCollider);\r\n                if(tag0 != null && tag0.tag == 0){\r\n                    let body = node.addComponent(cc.RigidBody);\r\n                    body.type = cc.RigidBodyType.Static;\r\n                    let ps = tag0.points;\r\n                    let collider = node.addComponent(cc.PhysicsPolygonCollider);\r\n                    for(let i=0;i<ps.length;i++){\r\n                        if(i > 3){\r\n                            collider.points.push({x:ps[i].x,y:ps[i].y});\r\n                        }else {\r\n                            collider.points[i].x = ps[i].x;\r\n                            collider.points[i].y = ps[i].y;\r\n                        }\r\n                    }\r\n                    collider.apply();\r\n                }\r\n            }\r\n        }\r\n        this.groundJs.killSprite=function(node,name){//每次图块从舞台上清除时调用    killSprite(图块：Node，图层名：String)\r\n            if(name == \"map\"){\r\n                let tag0 = node.getComponent(cc.PolygonCollider);\r\n                if(tag0 != null && tag0.tag == 0){\r\n                    let body = node.getComponent(cc.RigidBody);\r\n                    body.destroy();\r\n                }\r\n            }\r\n        }\r\n        this.groundJs.Loading=function(Loaded,Total){   //Loading(已加载的贴图数：Number，总贴图数：Number)\r\n            let progress = Loaded/Total;\r\n            if(_this.ready_play != null){\r\n                _this.ready_progressNum = progress;\r\n            }\r\n            if(_this.ready_progress != null){\r\n                _this.ready_progress.string =\"地图正在创建：\"+ progress*100+\"%\";\r\n            }\r\n        }\r\n    },\r\n\r\n    start () {\r\n        \r\n    },\r\n\r\n    closeDoor(point1,point2){   //关门时的点起火焰粒子\r\n\r\n    },\r\n\r\n    update (dt) {\r\n        if(this.ready_play != null){\r\n            let progress = this.ready_play.getComponent(cc.ProgressBar).progress;\r\n            if(progress <= this.ready_progressNum){\r\n                progress = progress+0.01;\r\n                this.ready_play.getComponent(cc.ProgressBar).progress = progress;\r\n                if(this.ready_play.getComponent(cc.ProgressBar).progress >= 1 && this.ready_play.getComponent(cc.ProgressBar).progress <= 1.02){\r\n                    this.ready_play.active = false;\r\n                    this.ready_progress.active = false;\r\n                    // this.node.getChildByName(\"ready_play\").destroy();\r\n                    cc.audioEngine.play(this.bg_audio,true,0.3);\r\n                    // this.node.getChildByName(\"hero\").active = true;\r\n                }\r\n            }\r\n        }\r\n    },\r\n});\r\n"]}