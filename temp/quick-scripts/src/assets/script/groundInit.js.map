{"version":3,"sources":["assets\\script\\groundInit.js"],"names":["cc","Class","Component","properties","hit_audio","type","AudioClip","bg_audio","ready_play","Node","ready_progress","Label","flameParticle","ParticleSystem","hero_pre","Prefab","mycamrea","onLoad","p","director","getPhysicsManager","enabled","gravity","v2","getCollisionManager","active","getComponent","ProgressBar","progress","string","groundJs","node","_this","Init","onLoadSpriteParent","n","LayerName","bo","onLoadYMovieClip","ymc","layerName","name","on","event","audioEngine","play","onLoadSprite","tag0","PolygonCollider","tag","RigidBody","PhysicsPolygonCollider","body","addComponent","RigidBodyType","Static","ps","points","collider","i","length","push","x","y","apply","killSprite","destroy","pp","killSpriteParent","Loading","Loaded","Total","ready_progressNum","start","onEnable","onDisable","generate","heroNode","instantiate","heroNodeJs","parent","getLayerNodeFun","groundJsNode","map","top","getChildByName","closeDoor","point1","point2","update","dt"],"mappings":"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","sourceRoot":"/","sourcesContent":["cc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        hit_audio:{    //击打时的音效\r\n            type:cc.AudioClip,\r\n            default:null\r\n        },\r\n        bg_audio:{    //背景音乐\r\n            type:cc.AudioClip,\r\n            default:null\r\n        },\r\n        ready_play:{   //游戏加载中的进度条\r\n            type:cc.Node,\r\n            default: null\r\n        },\r\n        ready_progress:{   //游戏加载中的当前进度label\r\n            type:cc.Label,\r\n            default:null\r\n        },\r\n        flameParticle:{   //火焰粒子，用在村庄门口的开门关门效果\r\n            type:cc.ParticleSystem,\r\n            default:null\r\n        },\r\n        hero_pre:{\r\n            type:cc.Prefab,\r\n            default:null\r\n        },\r\n        mycamrea:{\r\n            type:cc.Node,\r\n            default:null,\r\n        },\r\n    },\r\n\r\n    onLoad () {\r\n        let p = cc.director.getPhysicsManager();\r\n        p.enabled = true;\r\n        p.gravity = cc.v2(0,0);\r\n        // p.debugDrawFlags = true;  //显示出来碰撞边框，为了方便演示\r\n        cc.director.getCollisionManager().enabled = true; //检测碰撞\r\n        // cc.director.getCollisionManager().enabledDebugDraw = true;//碰撞检测的边框显示\r\n\r\n        this.ready_play.active = true;\r\n        this.ready_progress.active = true;\r\n        this.ready_play.getComponent(cc.ProgressBar).progress = 0;\r\n        this.ready_progress.string = \"地图正在初始化。。。\";\r\n\r\n        this.groundJs = this.node.getComponent(\"ground2\");\r\n        let _this = this;\r\n        _this.groundJs.Init=function(){\r\n            // _this.groundJs.mapCameraNode = this.mycamrea;\r\n            // hero_go.node.parent = _this.groundJs.getLayerNodeFun(\"map\");\r\n            // console.log(_this.groundJs.getLayerNodeFun(\"map\").Rect1);\r\n        }\r\n        _this.groundJs.onLoadSpriteParent=function(n,LayerName,bo){//onLoadSpriteParent(父节点：Node，图层名：String，是否第一次加载：bool)\r\n\r\n        }\r\n        _this.groundJs.onLoadYMovieClip=function(ymc,layerName,bo){//加载动画\r\n            if(ymc.name == \"hk1\"){\r\n                ymc.on(\"sound\",function(event){\r\n                    cc.audioEngine.play(_this.hit_audio,false,0.3);\r\n                })\r\n            }\r\n        }\r\n        this.groundJs.onLoadSprite=function(node,name){ //加载图块时调用  onLoadSprite(图块：Node，图层名：String)\r\n            if(name == \"map\"){\r\n                let tag0 = node.getComponent(cc.PolygonCollider);\r\n                if(tag0 != null && tag0.tag == 0 && node.getComponent(cc.RigidBody) == null && node.getComponent(cc.PhysicsPolygonCollider) == null){\r\n                    let body = node.addComponent(cc.RigidBody);\r\n                    body.type = cc.RigidBodyType.Static;\r\n                    let ps = tag0.points;\r\n                    let collider = node.addComponent(cc.PhysicsPolygonCollider);\r\n                    for(let i=0;i<ps.length;i++){\r\n                        if(i > 3){\r\n                            collider.points.push({x:ps[i].x,y:ps[i].y});\r\n                        }else {\r\n                            collider.points[i].x = ps[i].x;\r\n                            collider.points[i].y = ps[i].y;\r\n                        }\r\n                    }\r\n                    collider.apply();\r\n                }\r\n            }\r\n        }\r\n        this.groundJs.killSprite=function(node,name){//每次图块从舞台上清除时调用    killSprite(图块：Node，图层名：String)\r\n            if(name == \"map\"){\r\n                let tag0 = node.getComponent(cc.PolygonCollider);\r\n                if(tag0 != null && tag0.tag == 0){\r\n                    let body = node.getComponent(cc.RigidBody);\r\n                    if(body != null){\r\n                        body.destroy();\r\n                    }\r\n                    let pp = node.getComponent(cc.PhysicsPolygonCollider);\r\n                    if(pp != null){\r\n                        pp.destroy();\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        this.groundJs.killSpriteParent=function(n,LayerName){// 每次图块父节点从舞台上清除时调用。  killSpriteParent(父图块：Node，图层名：String)\r\n\r\n        }\r\n        this.groundJs.Loading=function(Loaded,Total){   //Loading(已加载的贴图数：Number，总贴图数：Number)\r\n            let progress = Loaded/Total;\r\n            if(_this.ready_play != null){\r\n                _this.ready_progressNum = progress;\r\n            }\r\n            if(_this.ready_progress != null){\r\n                _this.ready_progress.string =\"地图正在创建：\"+ progress*100+\"%\";\r\n            }\r\n        }\r\n    },\r\n\r\n    start () {\r\n        \r\n    },\r\n\r\n    onEnable(){//active,enable从false变成true\r\n\r\n    },\r\n    onDisable(){//active,enable从true变成false\r\n\r\n    },\r\n\r\n    generate(){//加载英雄预制体进入地图\r\n        let heroNode = cc.instantiate(this.hero_pre);\r\n        let heroNodeJs = heroNode.getComponent(\"hero_go\");\r\n        heroNode.parent = this.groundJs.getLayerNodeFun(\"map\");\r\n        // heroNode.setPosition(cc.v2(0,0));\r\n        heroNodeJs.mycamrea = this.mycamrea;\r\n        heroNodeJs.groundJsNode = this.node;\r\n        heroNodeJs.map = \"ground2\";\r\n        heroNodeJs.top = this.node.parent.getChildByName(\"top\");\r\n    },\r\n\r\n    closeDoor(point1,point2){   //关门时的点起火焰粒子\r\n\r\n    },\r\n\r\n    update (dt) {\r\n        // console.log(dt)\r\n        if(this.ready_play != null){\r\n            let progress = this.ready_play.getComponent(cc.ProgressBar).progress;\r\n            if(progress <= this.ready_progressNum){\r\n                progress = progress+0.01;\r\n                this.ready_play.getComponent(cc.ProgressBar).progress = progress;\r\n                if(this.ready_play.getComponent(cc.ProgressBar).progress >= 1 && this.ready_play.getComponent(cc.ProgressBar).progress <= 1.02){\r\n                    this.ready_play.active = false;\r\n                    this.ready_progress.active = false;\r\n                    // this.node.getChildByName(\"ready_play\").destroy();\r\n                    cc.audioEngine.play(this.bg_audio,true,0.3);\r\n                    this.generate();\r\n                    // this.node.getChildByName(\"hero\").active = true;\r\n                }\r\n            }\r\n        }\r\n    },\r\n});\r\n"]}