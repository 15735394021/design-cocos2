{"version":3,"sources":["assets\\script\\heroModel.js"],"names":["cc","Class","Component","properties","heroGrade","type","Node","heroExperience","heroLife","heroGold","die_audio","AudioClip","onLoad","window","heroModel","baseUrl","sys","localStorage","getItem","userId","director","loadScene","queryHeroDetail","xhr","XMLHttpRequest","onreadystatechange","readyState","status","response","JSON","parse","responseText","data","getComponent","Label","string","userGold","bind","open","send","addGrade","grade","parseInt","addExperience","num","totol","getChildByName","width","ProgressBar","totalLength","addLife","life","isDie","hit","die","audioEngine","play","timer1","setTimeout","alert","getScene","getName","addGold","gold","useGold","update","dt"],"mappings":"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","sourceRoot":"/","sourcesContent":["cc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        heroGrade:{//等级\r\n            type:cc.Node,\r\n            default:null\r\n        },\r\n        heroExperience:{//经验值\r\n            type:cc.Node,\r\n            default:null\r\n        },\r\n        heroLife:{//生命值\r\n            type:cc.Node,\r\n            default:null\r\n        },\r\n        heroGold:{//金币\r\n            type:cc.Node,\r\n            default:null\r\n        },\r\n        die_audio:{\r\n            type:cc.AudioClip,\r\n            default:null\r\n        }\r\n    },\r\n\r\n    onLoad () {\r\n        window.heroModel = this;\r\n        this.baseUrl = cc.sys.localStorage.getItem(\"baseUrl\");\r\n        this.userId = cc.sys.localStorage.getItem(\"userId\");\r\n        if(this.baseUrl == null || this.userId == null){\r\n            cc.director.loadScene(\"welcome\");\r\n        }\r\n        this.queryHeroDetail();\r\n    },\r\n\r\n    queryHeroDetail(){\r\n        let xhr = new XMLHttpRequest();\r\n        xhr.onreadystatechange = function () {\r\n            if (xhr.readyState == 4 && (xhr.status >= 200 && xhr.status < 400)) {\r\n                var response = JSON.parse(xhr.responseText);\r\n                if(response.status == 0){\r\n                    let data = response.data[0];\r\n                    this.heroGold.getComponent(cc.Label).string =data.userGold;\r\n                }\r\n            }\r\n        }.bind(this);\r\n        xhr.open(\"GET\", this.baseUrl+\"archives/queryArchives?userId=\"+this.userId, true);\r\n        xhr.send();\r\n    },\r\n\r\n    addGrade(){//增加等级\r\n        let grade = parseInt(this.heroGrade.getComponent(cc.Label).string);\r\n        this.heroGrade.getComponent(cc.Label).string = grade+1;\r\n    },\r\n\r\n    addExperience(num){//增加经验值\r\n        let totol = parseInt(this.heroExperience.getChildByName(\"bar\").width);\r\n        totol += parseInt(num);\r\n        if(totol < this.heroExperience.getComponent(cc.ProgressBar).totalLength){\r\n            this.heroExperience.getChildByName(\"bar\").width = totol;\r\n        }else{\r\n            this.addGrade();\r\n            this.heroExperience.getChildByName(\"bar\").width = totol/300;\r\n        }\r\n    },\r\n\r\n    addLife(num){\r\n        let life = parseInt(this.heroLife.getChildByName(\"bar\").width);\r\n        life += parseInt(num);\r\n        if(life < this.heroLife.getComponent(cc.ProgressBar).totalLength){\r\n            this.heroLife.getChildByName(\"bar\").width = life;\r\n        }else{\r\n            this.heroLife.getChildByName(\"bar\").width = 300;\r\n        }\r\n        this.isDie = false;\r\n        // let life = this.heroLife.getChildByName(\"bar\").scaleX;\r\n    },\r\n    hit(num){\r\n        let life = parseInt(this.heroLife.getChildByName(\"bar\").width);\r\n        life -= parseInt(num);\r\n        if(life > 0){\r\n            this.heroLife.getChildByName(\"bar\").width = life;\r\n        }else{\r\n            this.heroLife.getChildByName(\"bar\").width = 0;\r\n            if(this.isDie == true){\r\n                return;\r\n            }\r\n            this.isDie = true;\r\n            this.die();\r\n        }\r\n    },\r\n    die(){\r\n        cc.audioEngine.play(this.die_audio,false,0.4);\r\n        var timer1=window.setTimeout(function (){\r\n            alert(\"英雄死亡，点击确定重新加载当前地图\");\r\n            cc.director.loadScene(cc.director.getScene().getName());\r\n        },1000);\r\n        // heroGo.destroy();\r\n    },\r\n\r\n    addGold(num){//增加金币\r\n        let gold = parseInt(this.heroGold.getComponent(cc.Label).string);\r\n        this.heroGold.getComponent(cc.Label).string = gold+num;\r\n    },\r\n\r\n    useGold(num){//使用金币，减少\r\n        let gold = parseInt(this.heroGold.getComponent(cc.Label).string);\r\n        this.heroGold.getComponent(cc.Label).string = gold-num;\r\n    },\r\n\r\n    update (dt) {\r\n\r\n    },\r\n});\r\n"]}