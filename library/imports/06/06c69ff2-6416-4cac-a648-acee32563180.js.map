{"version":3,"sources":["assets\\script\\hero_go.js"],"names":["Input","State","stand","attack","noPlay","cc","Class","Component","properties","mycamrea","type","Node","groundJsNode","map","heroPos","kit_Audio","AudioClip","onLoad","window","heroGo","i","length","_this","rect","playing","walk","kit","jump","_speed1","_speed2","node","setPosition","v2","heroState","anima","_speed","sp","heroAnim","getComponent","Animation","combo","director","getPhysicsManager","gravity","y","systemEvent","on","SystemEvent","EventType","KEY_DOWN","on_key_down","KEY_UP","on_key_up","herobody","RigidBody","input_control","on_key_down_1","on_key_up_1","systemEventOff","off","kit_end","kit_start","audioEngine","play","setState","on_player_jump","v","linearVelocity","stop","direction","on_player_walk","dir","x","on_player_stop","e","keyCode","game","openAndClosePackage","getPosition","macro","KEY","l","q","noticeExit","b","t","closeTalk","find","destroy","start","groundJs","mapCameraNode","talkNum","update","dt","lv","j","d","scaleX","a","w","s"],"mappings":"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","sourceRoot":"/","sourcesContent":["const Input = {};\r\nconst State = {\r\n    stand:1,\r\n    attack:2,\r\n    noPlay:3\r\n}\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        mycamrea:{\r\n            type:cc.Node,\r\n            default:null,\r\n        },\r\n        groundJsNode:{\r\n            type:cc.Node,\r\n            default:null\r\n        },\r\n        map:null,\r\n        heroPos:null,\r\n        kit_Audio:{\r\n            type:cc.AudioClip,\r\n            default:null\r\n        }\r\n    },\r\n\r\n    onLoad () {\r\n        window.heroGo = this;\r\n        for(let i=0;i<Input.length;i++){\r\n            Input[i] = 0;\r\n        }\r\n        let _this = this;\r\n        _this.rect = null;\r\n        //人物的基本属性，速度，方向，重力\r\n        this.playing = true;//是否正在游戏中还是在查看背包，查看别的信息时角色不能移动\r\n        this.walk = false;\r\n        this.kit = false;\r\n        this.jump = false;\r\n        this._speed1 = 200;\r\n        this._speed2 = 300;\r\n        if(this.heroPos != null){\r\n            this.node.setPosition(this.heroPos);\r\n        }else{\r\n            this.node.setPosition(cc.v2(0,0));//初始位置\r\n        }\r\n        this.heroState = State.stand;\r\n        this.anima = \"hero_idle\";\r\n        this._speed = 200;\r\n        this.sp = cc.v2(0,0);  //角色当前移动的方向\r\n        this.heroAnim = this.node.getComponent(cc.Animation);\r\n        this.combo = 0;//是否处于连击状态\r\n\r\n        //注册事件监听\r\n        if(cc.director.getPhysicsManager().gravity.y == 0){//未开启重力的键盘监听，没有自由落体\r\n            cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN,this.on_key_down,this);//向系统注册键盘按下事件\r\n            cc.systemEvent.on(cc.SystemEvent.EventType.KEY_UP,this.on_key_up,this);//向系统注册键盘抬起事件\r\n        }else{//开启重力的键盘监听,有自由落体\r\n            this.herobody = this.node.getComponent(cc.RigidBody);//把刚体保存下来\r\n            this.input_control = 0;\r\n            cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN,this.on_key_down_1,this);//向系统注册键盘按下事件\r\n            cc.systemEvent.on(cc.SystemEvent.EventType.KEY_UP,this.on_key_up_1,this);//向系统注册键盘抬起事件\r\n        }\r\n\r\n    },\r\n    systemEventOff(){   //注销键盘监听事件\r\n        cc.systemEvent.off(cc.SystemEvent.EventType.KEY_DOWN,this.on_key_down_1,this);//向系统注册键盘按下事件\r\n        cc.systemEvent.off(cc.SystemEvent.EventType.KEY_UP,this.on_key_up_1,this);//向系统注册键盘抬起事件\r\n        cc.systemEvent.off(cc.SystemEvent.EventType.KEY_DOWN,this.on_key_down,this);//向系统注册键盘按下事件\r\n        cc.systemEvent.off(cc.SystemEvent.EventType.KEY_UP,this.on_key_up,this);//向系统注册键盘抬起事件\r\n    },\r\n\r\n\r\n    kit_end(){\r\n        this.heroState = State.stand;\r\n        // this.combo = (this.combo + 1) % 3;\r\n    },\r\n    kit_start(){\r\n        cc.audioEngine.play(this.kit_Audio,false,0.3);\r\n    },\r\n\r\n    setState(anima){\r\n        if(this.anima == anima)return;\r\n        this.anima = anima;\r\n        this.heroAnim.play(this.anima);\r\n    },\r\n\r\n    on_player_jump(){//有自由落体时的跳跃\r\n        this.jump = true;\r\n        var v = this.node.getComponent(cc.RigidBody).linearVelocity;\r\n        if(v.y == 0){\r\n            this.jump = false;\r\n        }\r\n        if(this.jump){\r\n            return;\r\n        }\r\n        if(this.input_control == -1){\r\n            this.heroAnim.stop(\"hero_left\");\r\n        }else if(this.input_control == 1){\r\n            this.heroAnim.stop(\"hero_right\");\r\n        }\r\n        this.direction = 0;\r\n        var v = this.node.getComponent(cc.RigidBody).linearVelocity;\r\n        v.y = 800;\r\n        this.node.getComponent(cc.RigidBody).linearVelocity = v;\r\n    },\r\n\r\n    on_player_walk(dir){//有自由落体时的行走\r\n        var v = this.node.getComponent(cc.RigidBody).linearVelocity;\r\n        v.x = (300 * dir);\r\n        this.node.getComponent(cc.RigidBody).linearVelocity = v;\r\n        if(this.direction == dir){\r\n            return\r\n        }\r\n        this.direction = dir;\r\n        if(dir == 1){\r\n            this.heroAnim.play(\"hero_right\");\r\n        }else if(dir == -1){\r\n            this.heroAnim.play(\"hero_left\");\r\n        }\r\n    },\r\n    on_player_stop(){//有自由落体时停止行走\r\n        if(this.input_control == -1){\r\n            this.heroAnim.stop(\"hero_left\");\r\n        }else if(this.input_control == 1){\r\n            this.heroAnim.stop(\"hero_right\");\r\n        }\r\n        this.input_control = 0;\r\n        this.direction = 0;\r\n    },\r\n    on_key_down_1(e){\r\n        switch(e.keyCode){\r\n            case 87:\r\n                this.on_player_jump();\r\n                break;\r\n            case 65:\r\n                this.input_control = -1;\r\n                break;\r\n            case 68:\r\n                this.input_control = 1;\r\n                break;\r\n            case 66:\r\n                this.playing = !this.playing;\r\n                game.openAndClosePackage(this.node.getPosition());\r\n                break;\r\n        }\r\n    },\r\n    on_key_up_1(e){\r\n        switch(e.keyCode){\r\n            case 65:\r\n                this.on_player_stop();\r\n                break;\r\n            case 68:\r\n                this.on_player_stop();\r\n                break;\r\n        }\r\n    },\r\n\r\n    on_key_down(e){           //w:87  s:83   a:65  d:68  j:74  k:75  l:76  u:85  i:73   o:79  shift:16   l:76   空格：32  q:81   t:84\r\n        Input[e.keyCode]=1;\r\n        switch (e.keyCode) {\r\n            case cc.macro.KEY.l:\r\n                this._speed = this._speed2;\r\n                break;\r\n            case cc.macro.KEY.q:  //q\r\n                game.noticeExit();\r\n                this.heroState = State.stand;\r\n                break;\r\n            case cc.macro.KEY.b:   //打开或关闭背包\r\n                this.heroState = this.heroState==State.stand?State.noPlay:State.stand;\r\n                game.openAndClosePackage(this.mycamrea.getPosition());\r\n                break;\r\n            case cc.macro.KEY.t:   //关闭对话\r\n                this.closeTalk();\r\n                break;\r\n        }\r\n    },\r\n    closeTalk(){\r\n        if(cc.find(\"Canvas/ground/talk\")){\r\n            this.heroState = State.stand;\r\n            cc.find(\"Canvas/ground/talk\").destroy();\r\n        }\r\n    },\r\n    on_key_up(e){        //w:87  s:83   a:65  d:68  j:74  k:75  l:76  u:85  i:73   o:79\r\n        Input[e.keyCode]=0;\r\n        switch(e.keyCode){\r\n            case cc.macro.KEY.l:\r\n                this._speed = this._speed1;\r\n                break;\r\n        }\r\n    },\r\n\r\n    start () {\r\n        this.groundJs = this.groundJsNode.getComponent(this.map);\r\n        this.groundJs.mapCameraNode = this.mycamrea;\r\n        this.talkNum = 0;\r\n    },\r\n\r\n    update (dt) {\r\n        if(this.playing){\r\n            if(cc.director.getPhysicsManager().gravity.y == 0){\r\n                let anima = this.anima;\r\n                this.lv = this.node.getComponent(cc.RigidBody).linearVelocity;\r\n\r\n                switch(this.heroState){\r\n                    case State.stand:\r\n                        if(Input[cc.macro.KEY.j]){\r\n                            this.heroState = State.attack;\r\n                        }\r\n                        break;\r\n                }\r\n                if(this.heroState == State.attack){\r\n                    if(Input[cc.macro.KEY.j]){\r\n                        if(this.combo == 0){\r\n                            anima = \"hero_right_kit\";\r\n                        }\r\n                        // else if(this.combo == 1){     //连击\r\n                        //     anmia = \"hero_up_kit\";\r\n                        // }else if(this.combo == 2){\r\n                        //     anima = \"hero_down_kit\";\r\n                        // }\r\n                    }\r\n                }\r\n                if(this.heroState != State.stand){\r\n                    this.sp.x = 0;\r\n                    this.sp.y = 0;\r\n                }else{\r\n                    // this.combo = 0;//取消掉连击\r\n                    if(Input[cc.macro.KEY.d]){\r\n                        this.sp.x = 1;\r\n                        this.sp.y = 0;\r\n                        anima = \"hero_right\";\r\n                        this.node.scaleX = 1;\r\n                    }else if(Input[cc.macro.KEY.a]){\r\n                        this.sp.x = -1;\r\n                        this.sp.y = 0;\r\n                        anima = \"hero_right\";\r\n                        this.node.scaleX = -1;\r\n                    }else if(Input[cc.macro.KEY.w]){\r\n                        this.sp.y = 1;\r\n                        this.sp.x = 0;\r\n                        anima = \"hero_up\";\r\n                    }else if(Input[cc.macro.KEY.s]){\r\n                        this.sp.y = -1;\r\n                        this.sp.x = 0;\r\n                        anima = \"hero_down\";\r\n                    }else{\r\n                        this.sp.y = 0;\r\n                        this.sp.x = 0;\r\n                        anima = \"hero_idle\";\r\n                    }\r\n                }\r\n\r\n                if(this.sp.x){\r\n                    this.lv.y = 0;\r\n                    this.lv.x = this.sp.x * this._speed;\r\n                }else if(this.sp.y){\r\n                    this.lv.x = 0;\r\n                    this.lv.y = this.sp.y * this._speed;\r\n                }else{\r\n                    this.lv.y = 0;\r\n                    this.lv.x = 0;\r\n                }\r\n                this.node.getComponent(cc.RigidBody).linearVelocity = this.lv;\r\n                if(anima){\r\n                    this.setState(anima);\r\n                }\r\n            }else{\r\n                if(this.input_control !== 0){\r\n                    this.on_player_walk(this.input_control);\r\n                }\r\n            }\r\n        }\r\n    },\r\n});\r\n"]}