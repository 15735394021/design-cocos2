{"version":3,"sources":["assets\\script\\hero_go.js"],"names":["Input","cc","Class","Component","properties","camrea","type","Node","groundJsNode","onLoad","groundJs","getComponent","_this","rect","fagPoint","Init","MapRect","fagPonint","flagPoint","width","height","mapCameraNode","node","parent","getLayerNodeFun","walk","kit","_speed","_speed1","_speed2","state","sp","v2","heroAnim","Animation","systemEvent","on","SystemEvent","EventType","KEY_DOWN","on_key_down","KEY_UP","on_key_up","onCollisionEnter","other","self","tag","gotoAndStop","currentFrame","setYMovieClipFrame","getTag","onCollisionStay","setState","play","hero_stop","stop","e","keyCode","start","update","dt","macro","KEY","d","x","a","w","y","s","lv","RigidBody","linearVelocity"],"mappings":";;;;;;AAAA,IAAMA,KAAK,GAAG,EAAd;AACAC,EAAE,CAACC,KAAH,CAAS;AACL,aAASD,EAAE,CAACE,SADP;AAGLC,EAAAA,UAAU,EAAE;AACRC,IAAAA,MAAM,EAAC;AACHC,MAAAA,IAAI,EAACL,EAAE,CAACM,IADL;AAEH,iBAAQ;AAFL,KADC;AAKRC,IAAAA,YAAY,EAAC;AACTF,MAAAA,IAAI,EAACL,EAAE,CAACM,IADC;AAET,iBAAQ;AAFC;AALL,GAHP;AAcLE,EAAAA,MAdK,oBAcK;AACN,SAAKC,QAAL,GAAgB,KAAKF,YAAL,CAAkBG,YAAlB,CAA+B,SAA/B,CAAhB;;AACA,QAAIC,KAAK,GAAG,IAAZ;;AACAA,IAAAA,KAAK,CAACC,IAAN,GAAa,IAAb;AACAD,IAAAA,KAAK,CAACE,QAAN,GAAiB,IAAjB;;AACA,SAAKJ,QAAL,CAAcK,IAAd,GAAmB,YAAU;AACzBH,MAAAA,KAAK,CAACC,IAAN,GAAaD,KAAK,CAACF,QAAN,CAAeM,OAA5B;AACAJ,MAAAA,KAAK,CAACK,SAAN,GAAkBL,KAAK,CAACF,QAAN,CAAeQ,SAAjC;AACAN,MAAAA,KAAK,CAACC,IAAN,CAAWM,KAAX,GAAmB,IAAnB;AACAP,MAAAA,KAAK,CAACC,IAAN,CAAWO,MAAX,GAAoB,IAApB;AACAR,MAAAA,KAAK,CAACF,QAAN,CAAeW,aAAf,GAA+BT,KAAK,CAACP,MAArC;AACAO,MAAAA,KAAK,CAACU,IAAN,CAAWC,MAAX,GAAoBX,KAAK,CAACF,QAAN,CAAec,eAAf,CAA+B,KAA/B,CAApB,CANyB,CAMiC;AAC1D;AACH,KARD,CALM,CAcN;;;AACA,QAAG,KAAKnB,MAAL,IAAe,IAAlB,EAAuB,CAEtB;;AACD,QAAG,KAAKG,YAAL,IAAqB,IAAxB,EAA6B,CAE5B,CApBK,CAqBN;;;AACA,SAAKiB,IAAL,GAAY,KAAZ;AACA,SAAKC,GAAL,GAAW,KAAX;AACA,SAAKC,MAAL,GAAc,GAAd;AACA,SAAKC,OAAL,GAAe,GAAf;AACA,SAAKC,OAAL,GAAe,GAAf;AACA,SAAKC,KAAL,GAAa,EAAb;AACA,SAAKC,EAAL,GAAU9B,EAAE,CAAC+B,EAAH,CAAM,CAAN,EAAQ,CAAR,CAAV,CA5BM,CA4BiB;;AACvB,SAAKC,QAAL,GAAgB,KAAKX,IAAL,CAAUX,YAAV,CAAuBV,EAAE,CAACiC,SAA1B,CAAhB,CA7BM,CA8BN;AACA;AACA;AACA;AACA;AACA;AACA;;AACAjC,IAAAA,EAAE,CAACkC,WAAH,CAAeC,EAAf,CAAkBnC,EAAE,CAACoC,WAAH,CAAeC,SAAf,CAAyBC,QAA3C,EAAoD,KAAKC,WAAzD,EAAqE,IAArE,EArCM,CAqCqE;;AAC3EvC,IAAAA,EAAE,CAACkC,WAAH,CAAeC,EAAf,CAAkBnC,EAAE,CAACoC,WAAH,CAAeC,SAAf,CAAyBG,MAA3C,EAAkD,KAAKC,SAAvD,EAAiE,IAAjE,EAtCM,CAsCiE;AAE1E,GAtDI;AAwDLC,EAAAA,gBAAgB,EAAC,0BAASC,KAAT,EAAiBC,IAAjB,EAAsB;AAAE;AACrC,QAAGD,KAAK,CAACE,GAAN,IAAa,IAAhB,EAAqB;AACjBF,MAAAA,KAAK,CAACtB,IAAN,CAAWyB,WAAX,CAAuBH,KAAK,CAACtB,IAAN,CAAW0B,YAAX,IAAyB,CAAzB,GAA2B,CAA3B,GAA6B,CAApD;AACA,WAAKtC,QAAL,CAAcuC,kBAAd,CAAiC,KAAKvC,QAAL,CAAcwC,MAAd,CAAqB,OAArB,CAAjC,EAA+DN,KAAK,CAACtB,IAAN,CAAW0B,YAA1E,EAAuF,KAAvF,EAFiB,CAE6E;AACjG;;AACD,QAAGJ,KAAK,CAACE,GAAN,IAAa,IAAhB,EAAqB;AACjB,WAAKpC,QAAL,CAAcc,eAAd,CAA8B,OAA9B,EAAuCD,MAAvC,GAAgD,KAAKf,YAArD;AACA,WAAKc,IAAL,CAAUC,MAAV,GAAmB,KAAKb,QAAL,CAAcc,eAAd,CAA8B,MAA9B,CAAnB;AACA,WAAKd,QAAL,CAAcc,eAAd,CAA8B,KAA9B,EAAqCD,MAArC,GAA8C,IAA9C;AACA,WAAKb,QAAL,CAAcc,eAAd,CAA8B,QAA9B,EAAwCD,MAAxC,GAAiD,IAAjD;AACH;AACJ,GAnEI;AAoEL4B,EAAAA,eAAe,EAAE,yBAAUP,KAAV,EAAiBC,IAAjB,EAAuB,CAAG;AAE1C,GAtEI;AAwELO,EAAAA,QAxEK,oBAwEItB,KAxEJ,EAwEU;AACX,QAAG,KAAKA,KAAL,IAAcA,KAAjB,EAAuB;AACnB,SAAKA,KAAL,GAAaA,KAAb;AACA,SAAKG,QAAL,CAAcoB,IAAd,CAAmB,KAAKvB,KAAxB;AACP,GA5EI;AA8ELwB,EAAAA,SA9EK,uBA8EM;AACP,SAAKrB,QAAL,CAAcsB,IAAd,CAAmB,KAAKzB,KAAxB;AACH,GAhFI;AAkFLU,EAAAA,WAlFK,uBAkFOgB,CAlFP,EAkFS;AAAY;AACtBxD,IAAAA,KAAK,CAACwD,CAAC,CAACC,OAAH,CAAL,GAAiB,CAAjB;;AACA,QAAGD,CAAC,CAACC,OAAF,IAAa,EAAhB,EAAmB;AACf,WAAK9B,MAAL,GAAc,KAAKE,OAAnB;AACH;AACJ,GAvFI;AAwFLa,EAAAA,SAxFK,qBAwFKc,CAxFL,EAwFO;AAAS;AACjBxD,IAAAA,KAAK,CAACwD,CAAC,CAACC,OAAH,CAAL,GAAiB,CAAjB;AACA,SAAK3B,KAAL,GAAa,EAAb;;AACA,YAAO0B,CAAC,CAACC,OAAT;AACI,WAAK,EAAL;AAAU;AACN,aAAKH,SAAL;AACA;;AACJ,WAAK,EAAL;AAAU;AACN,aAAKA,SAAL;AACA;;AACJ,WAAK,EAAL;AAAW;AACP,aAAKA,SAAL;AACA;;AACJ,WAAK,EAAL;AAAW;AACP,aAAKA,SAAL;AACA;;AACJ,WAAK,EAAL;AACI,aAAK3B,MAAL,GAAc,KAAKC,OAAnB;AACA;AAfR;AAiBH,GA5GI;AA8GL8B,EAAAA,KA9GK,mBA8GI,CAER,CAhHI;AAkHLC,EAAAA,MAlHK,kBAkHGC,EAlHH,EAkHO;AAER,QAAG5D,KAAK,CAACC,EAAE,CAAC4D,KAAH,CAASC,GAAT,CAAaC,CAAd,CAAR,EAAyB;AACrB,WAAKhC,EAAL,CAAQiC,CAAR,GAAY,CAAZ;AACH,KAFD,MAEM,IAAGhE,KAAK,CAACC,EAAE,CAAC4D,KAAH,CAASC,GAAT,CAAaG,CAAd,CAAR,EAAyB;AAC3B,WAAKlC,EAAL,CAAQiC,CAAR,GAAY,CAAC,CAAb;AACH,KAFK,MAED;AACD,WAAKjC,EAAL,CAAQiC,CAAR,GAAY,CAAZ;AACH;;AACD,QAAGhE,KAAK,CAACC,EAAE,CAAC4D,KAAH,CAASC,GAAT,CAAaI,CAAd,CAAR,EAAyB;AACrB,WAAKnC,EAAL,CAAQoC,CAAR,GAAY,CAAZ;AACH,KAFD,MAEM,IAAGnE,KAAK,CAACC,EAAE,CAAC4D,KAAH,CAASC,GAAT,CAAaM,CAAd,CAAR,EAAyB;AAC3B,WAAKrC,EAAL,CAAQoC,CAAR,GAAY,CAAC,CAAb;AACH,KAFK,MAED;AACD,WAAKpC,EAAL,CAAQoC,CAAR,GAAY,CAAZ;AACH;;AAED,SAAKE,EAAL,GAAU,KAAK/C,IAAL,CAAUX,YAAV,CAAuBV,EAAE,CAACqE,SAA1B,EAAqCC,cAA/C;;AAEA,QAAG,KAAKxC,EAAL,CAAQiC,CAAX,EAAa;AACT,WAAKK,EAAL,CAAQF,CAAR,GAAY,CAAZ;AACA,WAAKE,EAAL,CAAQL,CAAR,GAAY,KAAKjC,EAAL,CAAQiC,CAAR,GAAY,KAAKrC,MAA7B;AACH,KAHD,MAGM,IAAG,KAAKI,EAAL,CAAQoC,CAAX,EAAa;AACf,WAAKE,EAAL,CAAQL,CAAR,GAAY,CAAZ;AACA,WAAKK,EAAL,CAAQF,CAAR,GAAY,KAAKpC,EAAL,CAAQoC,CAAR,GAAY,KAAKxC,MAA7B;AACH,KAHK,MAGD;AACD,WAAK0C,EAAL,CAAQF,CAAR,GAAY,CAAZ;AACA,WAAKE,EAAL,CAAQL,CAAR,GAAY,CAAZ;AACH;;AACD,SAAK1C,IAAL,CAAUX,YAAV,CAAuBV,EAAE,CAACqE,SAA1B,EAAqCC,cAArC,GAAsD,KAAKF,EAA3D;AACA,QAAIvC,KAAK,GAAG,EAAZ;;AACA,QAAG,KAAKC,EAAL,CAAQiC,CAAR,IAAa,CAAhB,EAAkB;AACdlC,MAAAA,KAAK,GAAG,YAAR;AACH,KAFD,MAEM,IAAG,KAAKC,EAAL,CAAQiC,CAAR,IAAa,CAAC,CAAjB,EAAmB;AACrBlC,MAAAA,KAAK,GAAG,WAAR;AACH,KAFK,MAEA,IAAG,KAAKC,EAAL,CAAQoC,CAAR,IAAa,CAAhB,EAAkB;AACpBrC,MAAAA,KAAK,GAAG,SAAR;AACH,KAFK,MAEA,IAAG,KAAKC,EAAL,CAAQoC,CAAR,IAAa,CAAC,CAAjB,EAAmB;AACrBrC,MAAAA,KAAK,GAAG,WAAR;AACH;;AACD,QAAGA,KAAH,EAAS;AACL,WAAKsB,QAAL,CAActB,KAAd;AACH;;AACD,QAAG,KAAKzB,MAAL,KAAgB,IAAnB,EAAwB;AACpB,WAAKA,MAAL,CAAY2D,CAAZ,GAAgB,KAAK1C,IAAL,CAAU0C,CAA1B;AACA,WAAK3D,MAAL,CAAY8D,CAAZ,GAAgB,KAAK7C,IAAL,CAAU6C,CAA1B;;AACA,UAAG,KAAKlD,SAAL,IAAkB,IAAlB,IAA0B,KAAKJ,IAAL,IAAa,IAA1C,EAA+C,CAC3C;AACA;AACA;AACA;AACA;AACH;AACJ;AAEJ;AAzKI,CAAT","sourceRoot":"/","sourcesContent":["const Input = {};\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        camrea:{\r\n            type:cc.Node,\r\n            default:null,\r\n        },\r\n        groundJsNode:{\r\n            type:cc.Node,\r\n            default:null\r\n        }\r\n    },\r\n\r\n    onLoad () {\r\n        this.groundJs = this.groundJsNode.getComponent(\"ground2\");\r\n        let _this = this;\r\n        _this.rect = null;\r\n        _this.fagPoint = null;\r\n        this.groundJs.Init=function(){\r\n            _this.rect = _this.groundJs.MapRect;\r\n            _this.fagPonint = _this.groundJs.flagPoint;\r\n            _this.rect.width = 1500;\r\n            _this.rect.height = 1000;\r\n            _this.groundJs.mapCameraNode = _this.camrea;\r\n            _this.node.parent = _this.groundJs.getLayerNodeFun(\"map\");//把当前节点放进地图js的hero图层\r\n            // _this.groundJs.getLayerNodeFun(\"house\").parent = null;\r\n        }\r\n        //设置相机等属性，以及加入的map地图node\r\n        if(this.camrea == null){\r\n\r\n        }\r\n        if(this.groundJsNode == null){\r\n\r\n        }\r\n        //人物的基本属性，速度，方向，重力\r\n        this.walk = false;\r\n        this.kit = false;\r\n        this._speed = 200;\r\n        this._speed1 = 200;\r\n        this._speed2 = 300;\r\n        this.state = '';\r\n        this.sp = cc.v2(0,0);  //角色当前移动的方向\r\n        this.heroAnim = this.node.getComponent(cc.Animation);\r\n        // let p = cc.director.getPhysicsManager();    //得到物理组件\r\n        // p.enabled = true;  //启用物理引擎\r\n        // p.debugDrawFlags = true;  //显示出来碰撞边框，为了方便演示\r\n        // cc.director.getCollisionManager().enabled = true; //检测碰撞\r\n        // cc.director.getCollisionManager().enabledDebugDraw = true;//碰撞检测的边框显示\r\n        // p.gravity = cc.v2(0,0);    //关闭重力\r\n        //注册事件监听\r\n        cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN,this.on_key_down,this);//向系统注册键盘按下事件\r\n        cc.systemEvent.on(cc.SystemEvent.EventType.KEY_UP,this.on_key_up,this);//向系统注册键盘抬起事件\r\n        \r\n    },\r\n\r\n    onCollisionEnter:function(other , self){ //碰撞开始\r\n        if(other.tag == 1001){\r\n            other.node.gotoAndStop(other.node.currentFrame==1?5:1);\r\n            this.groundJs.setYMovieClipFrame(this.groundJs.getTag(\"a1001\"),other.node.currentFrame,false);//setYMovieClipFrame方法是播放制定动画的帧，第一个参数为动画标记，第二个是帧数，第三个是是播放还是跳到该帧就停止\r\n        }\r\n        if(other.tag == 2001){\r\n            this.groundJs.getLayerNodeFun(\"house\").parent = this.groundJsNode;\r\n            this.node.parent = this.groundJs.getLayerNodeFun(\"hero\");\r\n            this.groundJs.getLayerNodeFun(\"map\").parent = null;\r\n            this.groundJs.getLayerNodeFun(\"ground\").parent = null;\r\n        }\r\n    },\r\n    onCollisionStay: function (other, self) {  //碰撞持续\r\n        \r\n    },\r\n\r\n    setState(state){\r\n        if(this.state == state)return;\r\n            this.state = state;\r\n            this.heroAnim.play(this.state);\r\n    },\r\n\r\n    hero_stop(){\r\n        this.heroAnim.stop(this.state);\r\n    },\r\n\r\n    on_key_down(e){           //w:87  s:83   a:65  d:68  j:74  k:75  l:76  u:85  i:73   o:79  shift:16   l:76\r\n        Input[e.keyCode]=1;\r\n        if(e.keyCode == 76){\r\n            this._speed = this._speed2;\r\n        }\r\n    },\r\n    on_key_up(e){        //w:87  s:83   a:65  d:68  j:74  k:75  l:76  u:85  i:73   o:79\r\n        Input[e.keyCode]=0;\r\n        this.state = '';\r\n        switch(e.keyCode){\r\n            case 87:  //上\r\n                this.hero_stop();\r\n                break;\r\n            case 65:  //左\r\n                this.hero_stop();\r\n                break;\r\n            case 68:   //右\r\n                this.hero_stop();\r\n                break;\r\n            case 83:   //下\r\n                this.hero_stop();\r\n                break;\r\n            case 76:\r\n                this._speed = this._speed1;\r\n                break;\r\n        }\r\n    },\r\n\r\n    start () {\r\n\r\n    },\r\n\r\n    update (dt) {\r\n\r\n        if(Input[cc.macro.KEY.d]){\r\n            this.sp.x = 1;\r\n        }else if(Input[cc.macro.KEY.a]){\r\n            this.sp.x = -1;\r\n        }else{\r\n            this.sp.x = 0;\r\n        }\r\n        if(Input[cc.macro.KEY.w]){\r\n            this.sp.y = 1;\r\n        }else if(Input[cc.macro.KEY.s]){\r\n            this.sp.y = -1;\r\n        }else{\r\n            this.sp.y = 0;\r\n        }\r\n\r\n        this.lv = this.node.getComponent(cc.RigidBody).linearVelocity;\r\n\r\n        if(this.sp.x){\r\n            this.lv.y = 0;\r\n            this.lv.x = this.sp.x * this._speed;\r\n        }else if(this.sp.y){\r\n            this.lv.x = 0;\r\n            this.lv.y = this.sp.y * this._speed;\r\n        }else{\r\n            this.lv.y = 0;\r\n            this.lv.x = 0;\r\n        }\r\n        this.node.getComponent(cc.RigidBody).linearVelocity = this.lv;\r\n        let state = '';\r\n        if(this.sp.x == 1){\r\n            state = \"hero_right\";\r\n        }else if(this.sp.x == -1){\r\n            state = \"hero_left\";\r\n        }else if(this.sp.y == 1){\r\n            state = \"hero_up\";\r\n        }else if(this.sp.y == -1){\r\n            state = \"hero_down\";\r\n        }\r\n        if(state){\r\n            this.setState(state);\r\n        }\r\n        if(this.camrea !== null){\r\n            this.camrea.x = this.node.x;\r\n            this.camrea.y = this.node.y;\r\n            if(this.fagPonint != null && this.rect != null){\r\n                // console.log(this.fagPonint);\r\n                // this.fagPonint.x = this.node.x;\r\n                // this.fagPonint.y = this.node.y;\r\n                // this.rect.x = this.node.x;\r\n                // this.rect.y = this.node.y;\r\n            }\r\n        }\r\n\r\n    },\r\n});\r\n"]}