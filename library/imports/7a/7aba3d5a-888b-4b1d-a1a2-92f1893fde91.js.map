{"version":3,"sources":["assets\\script\\archivesList.js"],"names":["cc","Class","Component","properties","archivesPre","type","Prefab","onLoad","baseUrl","sys","localStorage","getItem","director","loadScene","userId","self","timer1","window","setTimeout","queryArchives","node","height","xhr","XMLHttpRequest","onreadystatechange","readyState","status","response","JSON","parse","responseText","data","createArchivesList","bind","console","log","open","send","i","length","archivesNode","instantiate","archivesJs","getComponent","archivesId","createTime","ts","archivesName","grade","userGrade","experience","userExperience","gold","userGold","describe","archivesDescribe","checkPoint","parent","setPosition","v2","start"],"mappings":"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","sourceRoot":"/","sourcesContent":["cc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        archivesPre:{\r\n            type:cc.Prefab,\r\n            default:null\r\n        }\r\n    },\r\n\r\n    onLoad () {\r\n        this.baseUrl = cc.sys.localStorage.getItem(\"baseUrl\");\r\n        if(this.baseUrl == null){\r\n            cc.director.loadScene(\"welcome\");\r\n        }\r\n        this.userId = cc.sys.localStorage.getItem(\"userId\");\r\n        if(this.userId == null){\r\n            cc.director.loadScene(\"welcome\");\r\n        }\r\n        let self = this;\r\n        var timer1=window.setTimeout(function (){\r\n            self.queryArchives();\r\n        },500);\r\n\r\n        this.node.height = 0; //初始化时设置档案纪录的content高度为0，之后每创建一行高度再增加\r\n    },\r\n\r\n    queryArchives(){\r\n        let xhr = new XMLHttpRequest();\r\n        xhr.onreadystatechange = function () {\r\n            if (xhr.readyState == 4 && (xhr.status >= 200 && xhr.status < 400)) {\r\n                var response = JSON.parse(xhr.responseText);\r\n                if(response.status == 0){\r\n                    let data = response.data;\r\n                    this.createArchivesList(data);\r\n                }\r\n            }\r\n        }.bind(this);\r\n        console.log(this.baseUrl+\"archives/queryArchives?userId=\"+this.userId)\r\n        xhr.open(\"GET\", this.baseUrl+\"archives/queryArchives?userId=\"+this.userId, true);\r\n        xhr.send();\r\n    },\r\n\r\n    createArchivesList(data){\r\n        for (let i = 0; i < data.length; i++) {\r\n            this.node.height += 80;\r\n            let archivesNode = cc.instantiate(this.archivesPre);\r\n            let archivesJs = archivesNode.getComponent(\"archive\");\r\n            archivesJs.archivesId = data[i].archivesId;\r\n            archivesJs.createTime = data[i].ts;\r\n            archivesJs.archivesName = data[i].archivesName;\r\n            archivesJs.grade = data[i].userGrade;\r\n            archivesJs.experience = data[i].userExperience;\r\n            archivesJs.gold = data[i].userGold;\r\n            archivesJs.describe = data[i].archivesDescribe;\r\n            archivesJs.checkPoint = data[i].checkPoint;\r\n            archivesNode.parent = this.node;\r\n            archivesNode.setPosition(cc.v2(0,-40 - 80 * i));\r\n        }\r\n    },\r\n\r\n    start () {\r\n        if(cc.sys.localStorage.getItem(\"checkPoint\") != null && cc.sys.localStorage.getItem(\"archivesId\")){\r\n            cc.director.loadScene(\"game\"+cc.sys.localStorage.getItem(\"checkPoint\"));\r\n        }\r\n        if(cc.sys.localStorage.getItem(\"userId\") == null){\r\n            cc.director.loadScene(\"welcome\");\r\n        }\r\n    },\r\n});\r\n"]}